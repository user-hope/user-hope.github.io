import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as l,o as n}from"./app-Dj3d3b-P.js";const t="/images/odoo/S12/user.png",e="/images/odoo/S12/user-group.png",h="/images/odoo/S12/access_right.png",k="/images/odoo/S12/access_rules.png",p={};function d(r,i){return n(),a("div",null,i[0]||(i[0]=[l('<h2 id="权限" tabindex="-1"><a class="header-anchor" href="#权限"><span>权限</span></a></h2><p>odoo 的权限管理, 从粗到细大致可以分为四个级别:</p><ul><li><strong>访问权限</strong>: 以模型为基准的权限划分, 可以理解为数据库中表级别的访问权限控制;</li><li><strong>视图权限</strong>: 以视图为基准的权限划分, 不同的用户组可以看到不同的视图;</li><li><strong>记录规则</strong>: 以记录集为准则的权限划分, 不同的记录集适用于不同的规则体系下的用户权限访问控制;</li><li><strong>字段权限</strong>: 以字段为基准的权限划分, 对字段进行访问权限控制;</li></ul><p>在了解这几个权限控制之前, 我们需要首先认识 odoo 权限控制系统中的: 用户和组, 因为所有的权限都是基于用户和用户组去实现的;</p><h2 id="用户" tabindex="-1"><a class="header-anchor" href="#用户"><span>用户</span></a></h2><p>odoo 的用户也是我们平时使用其它系统中的用户的概念, 它代表了可以合法访问系统资源的对象; 在 odoo 中, 用户可以分为三种类型:</p><ul><li><strong>内部用户</strong>: 对于系统中的用户, 通常是企业内部用户 <code>has_group(&#39;base.group_user&#39;)</code>;</li><li><strong>网站用户</strong>: 可以通过注册而来的用户, 此类用户不能登录内部系统, 只能拥有一个有限权限的门户账号, 通常对应于企业的客户或供应商群体 <code>has_group(&#39;base.group_portal&#39;)</code>;</li><li><strong>公开用户</strong>: 即无需注册就可以查看的用户, 有限的访问权限, 一般对应于游客权限 <code>has_group(&#39;base.group_public&#39;)</code>;</li></ul><p>打开 <code>Setting</code> --&gt; <code>Users &amp; Companies</code> --&gt; <code>Users</code></p><figure><img src="'+t+`" alt="user" tabindex="0" loading="lazy"><figcaption>user</figcaption></figure><blockquote><p>如果看不见 <code>User Types</code> 请使用 <code>debug=1</code> 调试模式, 或者是超级用户模式; 具体用户的定义可以查看 <code>odoo/addons/base/models/res_users.py</code> 源代码;</p></blockquote><p>用户在 odoo 中对应的模型是 <code>res.users</code>; 在创建用户的时候, 系统会自动创建一个 <code>partner</code> 对象, 并关联到用户上;</p><h2 id="用户组" tabindex="-1"><a class="header-anchor" href="#用户组"><span>用户组</span></a></h2><p>用户组在 odoo 中的对象模型是 <code>res.groups</code>, 一个组里包含多个用户与用户是一对多的关系;</p><p>用户组用于将用户组织成逻辑集合, 并为这些用户集合定义权限; 用户组可用于简化权限管理, 例如将所有销售人员分配到一个名为 &quot;销售团队&quot; 的用户组中, 然后为这个用户组设置与销售相关的权限;</p><p>一般, 用户组包含以下几个字段:</p><ul><li><strong><code>name</code></strong>: 用户组的名称, 用来在 <code>groups</code> 列表中展示;</li><li><strong><code>category_id</code></strong>: 模块类别的 id, 用于在用户表单中组织分组;</li><li><strong><code>implied_ids</code></strong>: 与当前组一起为用户设置的其他组, 这是一种方便的伪继承关系;</li><li><strong><code>comment</code></strong>: 关于组的附加说明;</li></ul><p>例如, 我们在图书章节创建的 <code>Library</code> 用户组:</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">odoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        &lt;!-- Library User Group --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">record</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;library_group_user&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> model</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;res.groups&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;User&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;category_id&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;base.module_category_services_library&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;implied_ids&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> eval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;[(4, ref(&#39;base.group_user&#39;))]&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">record</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        &lt;!-- Library Manager Group --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">record</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;library_group_manager&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> model</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;res.groups&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;Manager&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;category_id&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;base.module_category_services_library&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;implied_ids&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> eval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;[(4, ref(&#39;library_group_user&#39;))]&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;users&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> eval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;[(4, ref(&#39;base.user_root&#39;)), (4, ref(&#39;base.user_admin&#39;))]&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">record</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">odoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>打开 <code>Setting</code> --&gt; <code>Users &amp; Companies</code> --&gt; <code>Groups</code></p><figure><img src="`+e+`" alt="user-group" tabindex="0" loading="lazy"><figcaption>user-group</figcaption></figure><h2 id="访问权限" tabindex="-1"><a class="header-anchor" href="#访问权限"><span>访问权限</span></a></h2><p>访问权限是对给定操作集的整个模型的权限, 如果没有访问权限与用户组对模型的关联, 则该用户无权访问; 访问权是累加的, 用户的访问权是它们通过所有的组获得的访问权的并集;</p><p>例如: 如果 A 用户组赋予了读取和创建的权限, B 用户组赋予了更新的权限, 那么该用户将拥有创建, 读取, 更新这三个权限;</p><p>访问权在 odoo 中是一个 <code>ir.model.access</code>, 其中包含以下选项:</p><ul><li><strong><code>name</code></strong>: 访问权限展示的名称;</li><li><strong><code>model_id</code></strong>: ACL 控制其访问权限的模型;</li><li><strong><code>group_id</code></strong>: 被授予访问权限的 <code>res.groups</code> 组, 如果为空, 则表示 ACL 被授予每个用户;</li><li><strong><code>perm_{create, read, write, unlink}</code></strong>: 在设置时授予相应的 CRUD 访问权限, 默认情况下它们都是未设置的;</li></ul><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;?</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">xml</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1.0&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> encoding</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;utf-8&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">?&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">odoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> noupdate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">record</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;access_account_analytic_line_portal_user&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> model</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ir.model.access&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;analytic.account.analytic.line.timesheet.portal.user&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;model_id&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;analytic.model_account_analytic_line&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;group_id&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;base.group_portal&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;active&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;0&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;perm_read&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;1&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;perm_write&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;0&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;perm_create&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;0&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;perm_unlink&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;0&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">record</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">odoo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通常情况下, 一个模型会有很多个访问权限, 前面的文章中有讲过, 如果都使用 <code>xml</code> 来定义的话, 会显得很冗长, 因此, 一般的做法是将访问权统一规范的放在 <code>&lt;moduleName&gt;/security/ir.model.access.csv</code> 文件中;</p><p>上面的 <code>xml</code> 转换为 <code>csv</code> 如下:</p><div class="language-csv line-numbers-mode" data-highlighter="shiki" data-ext="csv" data-title="csv" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">id,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">name,</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">model_id:id,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">group_id:id,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">perm_read,</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">perm_write,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">perm_create,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">perm_unlink</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">access_account_analytic_line_portal_user,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">analytic.account.analytic.line.timesheet.portal.user,</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">analytic.model_account_analytic_line,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">base.group_portal,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1,</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">0,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>打开 <code>Setting</code> --&gt; <code>Technical</code> --&gt; <code>Security</code> --&gt; <code>Access Rights</code>:</p><figure><img src="`+h+`" alt="access-rights" tabindex="0" loading="lazy"><figcaption>access-rights</figcaption></figure><h2 id="记录规则" tabindex="-1"><a class="header-anchor" href="#记录规则"><span>记录规则</span></a></h2><p>访问权限只能限制用户组对模型对象的访问权限, 并不能限制特定用户对某一些记录的访问; 举例来说: 销售人员 A 赋予了销售订单 <code>sale.order</code> 模型的访问权限, 他能够看到全公司的销售订单; 很显然, 这是不可以接受的; 通常的规则是, 销售人员 A 只能看到自己创建的销售单据;</p><p>在 odoo 中, 这种需求的方案就是记录规则; 记录规则默认为允许, 如果仅授予访问权限, 没有添加记录规则, 那么对于记录的访问权限将由模型的访问权限来控制;</p><p>odoo 的记录规则是一个 <code>ir.rule</code> 的记录, 它接受以下属性:</p><ul><li><strong><code>name</code></strong>: 记录规则的显示名称;</li><li><strong><code>model_id</code></strong>: 应用规则的模型的 id;</li><li><strong><code>groups</code></strong>: 被授予访问权限的 <code>res.groups</code> 组, 可以指定多个组; 如果为空, 则规则是全局规则;</li><li><strong><code>global</code></strong>: 用于指定记录规则是否是全局的, 如果将 <code>global</code> 属性设置为 <code>True</code>, 则表示这条记录规则将会应用于所有用户, 而不管他们所属的用户组如何; 通常用于设置一些通用权限;</li><li><strong><code>domain_force</code></strong>: 可以用来强制性地定义一个筛选条件, 从而限制用户在查看、编辑或删除记录时的权限; 这个条件将被应用到数据库查询中, 以限制用户对特定记录的访问; 可以使用以下变量: <ul><li><strong><code>time</code></strong>: python 的 time 模块;</li><li><strong><code>user</code></strong>: 当前的用户的记录;</li><li><strong><code>company_id</code></strong>: 当前用户所选择的公司记录;</li><li><strong><code>company_ids</code></strong>: 当前用户有权访问的所有公司作为公司 ID 列表;</li></ul></li><li><strong><code>perm_{create, read, write, unlink}</code></strong>: 在设置时授予相应的 CRUD 访问权限, 默认情况下它们都是未设置的;</li></ul><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">record</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;website_designer_edit_qweb&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> model</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ir.rule&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;website_designer: Manage Website and qWeb view&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;model_id&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;base.model_ir_ui_view&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;domain_force&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;[(&#39;type&#39;, &#39;=&#39;, &#39;qweb&#39;)]&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;groups&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> eval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;[(4, ref(&#39;group_website_designer&#39;))]&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;perm_read&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> eval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;True&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;perm_write&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> eval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;True&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;perm_create&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> eval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;True&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;perm_unlink&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> eval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;True&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">record</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="全局规则和组" tabindex="-1"><a class="header-anchor" href="#全局规则和组"><span>全局规则和组</span></a></h2><p>全局规则和组规则在如何组成和组合方面存在很大差异:</p><ul><li>全局规则相交, 如果应用两个全局规则, 则必须满足两个全局规则才能授予访问权限, 这意味着添加全局规则总是会进一步限制访问;</li><li>组规则统一, 如果应用两个组规则, 则可以满足任一组规则来授予访问权限; 这意味着添加组规则可以扩展访问权限, 但不能超出全局规则定义的范围;</li><li>全局规则集和组规则集相交, 这意味着添加到给定全局规则集的第一个组规则将限制访问;</li></ul><p>以上这些规则记录都可以在 <code>Setting</code> --&gt; <code>Users &amp; Companies</code> --&gt; <code>Groups</code> 里面看到, 下面的选项卡中对应的就是视图规则, 权限规则, 和记录规则;</p><figure><img src="`+k+`" alt="access-rules" tabindex="0" loading="lazy"><figcaption>access-rules</figcaption></figure><h2 id="字段权限" tabindex="-1"><a class="header-anchor" href="#字段权限"><span>字段权限</span></a></h2><p>ORM 的 <code>field</code> 字段可以有一个 <code>groups</code> 属性提供组列表, 多个分组以 <code>,</code> 隔开;</p><p>如果当前用户不在列出的组中, 他将无权访问该字段:</p><ul><li>受限制字段将从请求的视图中自动删除;</li><li>受限制字段从模型方法 <code>fields_get()</code> 响应中删除;</li><li>尝试读取或者是写入受限字段会导致访问错误;</li></ul><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">record</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;view_account_group_tree&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> model</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ir.ui.view&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;account.group.tree&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;model&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;account.group&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;arch&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;xml&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tree</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Account Group&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;code_prefix_start&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;code_prefix_end&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line highlighted"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;company_id&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> groups</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;base.group_multi_company&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tree</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">field</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">record</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安全陷阱" tabindex="-1"><a class="header-anchor" href="#安全陷阱"><span>安全陷阱</span></a></h2><p>作为开发人员, 了解安全机制并避免导致代码不安全的常见错误是非常重要的;</p><h3 id="不安全的公共方法" tabindex="-1"><a class="header-anchor" href="#不安全的公共方法"><span>不安全的公共方法</span></a></h3><p>任何公共方法都可以通过使用所选参数的 RPC 调用来执行, 以 <code>_</code> 开头的方法无法从操作按钮或外部 API 调用;</p><p>以 <code>_</code> 命名的方法会被标记为私有方法, 是不能通过 <code>rpc</code> 来进行调用的, 但是是可以被其他 python 代码来进行引用执行的, 因此也需要注意在方法内部的 CRUD 调用;</p><h3 id="绕过-orm" tabindex="-1"><a class="header-anchor" href="#绕过-orm"><span>绕过 ORM</span></a></h3><p>当 ORM 可以做同样的事情的时候, 就优先使用 ORM 提供的方法; 而不直接使用原生 sql 语句查询, 因为直接允许 sql 会绕过所有的 orm 检查, 包括上面的权限规则和记录规则;</p><h3 id="sql-注入" tabindex="-1"><a class="header-anchor" href="#sql-注入"><span>sql 注入</span></a></h3><p>在使用手动 sql 查询时, 必须注意 sql 注入漏洞; 当用户在输入错误的筛选或者引用时候, 就会出现该漏洞, 从而允许攻击者在 sql 查询中引入不需要的子句(例如: 绕过筛选器或者执行 UPDATE, DELETE 命令);</p><p>最好的安全方法时永远不要使用 python 的 <code>+</code> 或者是字符串插值 <code>%</code> 将变量传递给 sql 查询字符串;</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 错误的示例</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.env.cr.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">execute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;SELECT distinct child_id FROM account_account_consol_rel &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">           &#39;WHERE parent_id IN (&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;,&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">str</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ids))</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;)&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 正确的示例</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.env.cr.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">execute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;SELECT DISTINCT child_id &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\\</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">           &#39;FROM account_account_consol_rel &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\\</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">           &#39;WHERE parent_id IN </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">           (</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">tuple</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ids),))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,58)]))}const B=s(p,[["render",d],["__file","权限安全.html.vue"]]),A=JSON.parse('{"path":"/pages/web-server/odoo/section-02/%E6%9D%83%E9%99%90%E5%AE%89%E5%85%A8.html","title":"","lang":"zh-CN","frontmatter":{"headerDepth":3,"prev":{"link":"/pages/web-server/odoo/section-01/Manifest.md"},"next":{"link":"/pages/web-server/odoo/section-02/控制器.md"},"description":"权限 odoo 的权限管理, 从粗到细大致可以分为四个级别: 访问权限: 以模型为基准的权限划分, 可以理解为数据库中表级别的访问权限控制; 视图权限: 以视图为基准的权限划分, 不同的用户组可以看到不同的视图; 记录规则: 以记录集为准则的权限划分, 不同的记录集适用于不同的规则体系下的用户权限访问控制; 字段权限: 以字段为基准的权限划分, 对字段...","gitInclude":[],"head":[["meta",{"property":"og:url","content":"https://github.com/user-hope/user-hope.github.io/pages/web-server/odoo/section-02/%E6%9D%83%E9%99%90%E5%AE%89%E5%85%A8.html"}],["meta",{"property":"og:site_name","content":"Blog"}],["meta",{"property":"og:description","content":"权限 odoo 的权限管理, 从粗到细大致可以分为四个级别: 访问权限: 以模型为基准的权限划分, 可以理解为数据库中表级别的访问权限控制; 视图权限: 以视图为基准的权限划分, 不同的用户组可以看到不同的视图; 记录规则: 以记录集为准则的权限划分, 不同的记录集适用于不同的规则体系下的用户权限访问控制; 字段权限: 以字段为基准的权限划分, 对字段..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://github.com/user-hope/user-hope.github.io/images/odoo/S12/user.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"https://github.com/user-hope/user-hope.github.io/images/odoo/S12/user.png\\",\\"https://github.com/user-hope/user-hope.github.io/images/odoo/S12/user-group.png\\",\\"https://github.com/user-hope/user-hope.github.io/images/odoo/S12/access_right.png\\",\\"https://github.com/user-hope/user-hope.github.io/images/odoo/S12/access_rules.png\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.Hope\\",\\"url\\":\\"https://github.com/user-hope/user-hope.github.io\\"}]}"]]},"headers":[{"level":2,"title":"权限","slug":"权限","link":"#权限","children":[]},{"level":2,"title":"用户","slug":"用户","link":"#用户","children":[]},{"level":2,"title":"用户组","slug":"用户组","link":"#用户组","children":[]},{"level":2,"title":"访问权限","slug":"访问权限","link":"#访问权限","children":[]},{"level":2,"title":"记录规则","slug":"记录规则","link":"#记录规则","children":[]},{"level":2,"title":"全局规则和组","slug":"全局规则和组","link":"#全局规则和组","children":[]},{"level":2,"title":"字段权限","slug":"字段权限","link":"#字段权限","children":[]},{"level":2,"title":"安全陷阱","slug":"安全陷阱","link":"#安全陷阱","children":[{"level":3,"title":"不安全的公共方法","slug":"不安全的公共方法","link":"#不安全的公共方法","children":[]},{"level":3,"title":"绕过 ORM","slug":"绕过-orm","link":"#绕过-orm","children":[]},{"level":3,"title":"sql 注入","slug":"sql-注入","link":"#sql-注入","children":[]}]}],"readingTime":{"minutes":8.24,"words":2472},"filePathRelative":"pages/web-server/odoo/section-02/权限安全.md","autoDesc":true,"excerpt":"<h2>权限</h2>\\n<p>odoo 的权限管理, 从粗到细大致可以分为四个级别:</p>\\n<ul>\\n<li><strong>访问权限</strong>: 以模型为基准的权限划分, 可以理解为数据库中表级别的访问权限控制;</li>\\n<li><strong>视图权限</strong>: 以视图为基准的权限划分, 不同的用户组可以看到不同的视图;</li>\\n<li><strong>记录规则</strong>: 以记录集为准则的权限划分, 不同的记录集适用于不同的规则体系下的用户权限访问控制;</li>\\n<li><strong>字段权限</strong>: 以字段为基准的权限划分, 对字段进行访问权限控制;</li>\\n</ul>"}');export{B as comp,A as data};
