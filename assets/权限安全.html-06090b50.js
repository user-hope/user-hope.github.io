import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{o as n,c as s,e as t}from"./app-9b0cd270.js";const p="/images/odoo/S12/user.png",e="/images/odoo/S12/user-group.png",o="/images/odoo/S12/access_right.png",c="/images/odoo/S12/access_rules.png",l={},u=t('<h2 id="权限" tabindex="-1"><a class="header-anchor" href="#权限" aria-hidden="true">#</a> 权限</h2><p>odoo 的权限管理, 从粗到细大致可以分为四个级别:</p><ul><li><strong>访问权限</strong>: 以模型为基准的权限划分, 可以理解为数据库中表级别的访问权限控制;</li><li><strong>视图权限</strong>: 以视图为基准的权限划分, 不同的用户组可以看到不同的视图;</li><li><strong>记录规则</strong>: 以记录集为准则的权限划分, 不同的记录集适用于不同的规则体系下的用户权限访问控制;</li><li><strong>字段权限</strong>: 以字段为基准的权限划分, 对字段进行访问权限控制;</li></ul><p>在了解这几个权限控制之前, 我们需要首先认识 odoo 权限控制系统中的: 用户和组, 因为所有的权限都是基于用户和用户组去实现的;</p><h2 id="用户" tabindex="-1"><a class="header-anchor" href="#用户" aria-hidden="true">#</a> 用户</h2><p>odoo 的用户也是我们平时使用其它系统中的用户的概念, 它代表了可以合法访问系统资源的对象; 在 odoo 中, 用户可以分为三种类型:</p><ul><li><strong>内部用户</strong>: 对于系统中的用户, 通常是企业内部用户 <code>has_group(&#39;base.group_user&#39;)</code>;</li><li><strong>网站用户</strong>: 可以通过注册而来的用户, 此类用户不能登录内部系统, 只能拥有一个有限权限的门户账号, 通常对应于企业的客户或供应商群体 <code>has_group(&#39;base.group_portal&#39;)</code>;</li><li><strong>公开用户</strong>: 即无需注册就可以查看的用户, 有限的访问权限, 一般对应于游客权限 <code>has_group(&#39;base.group_public&#39;)</code>;</li></ul><p>打开 <code>Setting</code> --&gt; <code>Users &amp; Companies</code> --&gt; <code>Users</code></p><p><img src="'+p+`" alt="user"></p><blockquote><p>如果看不见 <code>User Types</code> 请使用 <code>debug=1</code> 调试模式, 或者是超级用户模式; 具体用户的定义可以查看 <code>odoo/addons/base/models/res_users.py</code> 源代码;</p></blockquote><p>用户在 odoo 中对应的模型是 <code>res.users</code>; 在创建用户的时候, 系统会自动创建一个 <code>partner</code> 对象, 并关联到用户上;</p><h2 id="用户组" tabindex="-1"><a class="header-anchor" href="#用户组" aria-hidden="true">#</a> 用户组</h2><p>用户组在 odoo 中的对象模型是 <code>res.groups</code>, 一个组里包含多个用户与用户是一对多的关系;</p><p>用户组用于将用户组织成逻辑集合, 并为这些用户集合定义权限; 用户组可用于简化权限管理, 例如将所有销售人员分配到一个名为 &quot;销售团队&quot; 的用户组中, 然后为这个用户组设置与销售相关的权限;</p><p>一般, 用户组包含以下几个字段:</p><ul><li><strong><code>name</code></strong>: 用户组的名称, 用来在 <code>groups</code> 列表中展示;</li><li><strong><code>category_id</code></strong>: 模块类别的 id, 用于在用户表单中组织分组;</li><li><strong><code>implied_ids</code></strong>: 与当前组一起为用户设置的其他组, 这是一种方便的伪继承关系;</li><li><strong><code>comment</code></strong>: 关于组的附加说明;</li></ul><p>例如, 我们在图书章节创建的 <code>Library</code> 用户组:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>odoo</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Library User Group --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>library_group_user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>res.groups<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>User<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>category_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.module_category_services_library<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>implied_ids<span class="token punctuation">&quot;</span></span> <span class="token attr-name">eval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[(4, ref(&#39;base.group_user&#39;))]<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!-- Library Manager Group --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>library_group_manager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>res.groups<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Manager<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>category_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.module_category_services_library<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>implied_ids<span class="token punctuation">&quot;</span></span> <span class="token attr-name">eval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[(4, ref(&#39;library_group_user&#39;))]<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>users<span class="token punctuation">&quot;</span></span> <span class="token attr-name">eval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[(4, ref(&#39;base.user_root&#39;)), (4, ref(&#39;base.user_admin&#39;))]<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>odoo</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>打开 <code>Setting</code> --&gt; <code>Users &amp; Companies</code> --&gt; <code>Groups</code></p><p><img src="`+e+`" alt="user-group"></p><h2 id="访问权限" tabindex="-1"><a class="header-anchor" href="#访问权限" aria-hidden="true">#</a> 访问权限</h2><p>访问权限是对给定操作集的整个模型的权限, 如果没有访问权限与用户组对模型的关联, 则该用户无权访问; 访问权是累加的, 用户的访问权是它们通过所有的组获得的访问权的并集;</p><p>例如: 如果 A 用户组赋予了读取和创建的权限, B 用户组赋予了更新的权限, 那么该用户将拥有创建, 读取, 更新这三个权限;</p><p>访问权在 odoo 中是一个 <code>ir.model.access</code>, 其中包含以下选项:</p><ul><li><strong><code>name</code></strong>: 访问权限展示的名称;</li><li><strong><code>model_id</code></strong>: ACL 控制其访问权限的模型;</li><li><strong><code>group_id</code></strong>: 被授予访问权限的 <code>res.groups</code> 组, 如果为空, 则表示 ACL 被授予每个用户;</li><li><strong><code>perm_{create, read, write, unlink}</code></strong>: 在设置时授予相应的 CRUD 访问权限, 默认情况下它们都是未设置的;</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>odoo</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">noupdate</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>access_account_analytic_line_portal_user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ir.model.access<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>analytic.account.analytic.line.timesheet.portal.user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>model_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>analytic.model_account_analytic_line<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>group_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.group_portal<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>active<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>perm_read<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>perm_write<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>perm_create<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>perm_unlink<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>odoo</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通常情况下, 一个模型会有很多个访问权限, 前面的文章中有讲过, 如果都使用 <code>xml</code> 来定义的话, 会显得很冗长, 因此, 一般的做法是将访问权统一规范的放在 <code>&lt;moduleName&gt;/security/ir.model.access.csv</code> 文件中;</p><p>上面的 <code>xml</code> 转换为 <code>csv</code> 如下:</p><div class="language-csv line-numbers-mode" data-ext="csv"><pre class="language-csv"><code><span class="token value">id</span><span class="token punctuation">,</span><span class="token value">name</span><span class="token punctuation">,</span><span class="token value">model_id:id</span><span class="token punctuation">,</span><span class="token value">group_id:id</span><span class="token punctuation">,</span><span class="token value">perm_read</span><span class="token punctuation">,</span><span class="token value">perm_write</span><span class="token punctuation">,</span><span class="token value">perm_create</span><span class="token punctuation">,</span><span class="token value">perm_unlink</span>
<span class="token value">access_account_analytic_line_portal_user</span><span class="token punctuation">,</span><span class="token value">analytic.account.analytic.line.timesheet.portal.user</span><span class="token punctuation">,</span><span class="token value">analytic.model_account_analytic_line</span><span class="token punctuation">,</span><span class="token value">base.group_portal</span><span class="token punctuation">,</span><span class="token value">1</span><span class="token punctuation">,</span><span class="token value">0</span><span class="token punctuation">,</span><span class="token value">0</span><span class="token punctuation">,</span><span class="token value">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>打开 <code>Setting</code> --&gt; <code>Technical</code> --&gt; <code>Security</code> --&gt; <code>Access Rights</code>:</p><p><img src="`+o+`" alt="access-rights"></p><h2 id="记录规则" tabindex="-1"><a class="header-anchor" href="#记录规则" aria-hidden="true">#</a> 记录规则</h2><p>访问权限只能限制用户组对模型对象的访问权限, 并不能限制特定用户对某一些记录的访问; 举例来说: 销售人员 A 赋予了销售订单 <code>sale.order</code> 模型的访问权限, 他能够看到全公司的销售订单; 很显然, 这是不可以接受的; 通常的规则是, 销售人员 A 只能看到自己创建的销售单据;</p><p>在 odoo 中, 这种需求的方案就是记录规则; 记录规则默认为允许, 如果仅授予访问权限, 没有添加记录规则, 那么对于记录的访问权限将由模型的访问权限来控制;</p><p>odoo 的记录规则是一个 <code>ir.rule</code> 的记录, 它接受以下属性:</p><ul><li><strong><code>name</code></strong>: 记录规则的显示名称;</li><li><strong><code>model_id</code></strong>: 应用规则的模型的 id;</li><li><strong><code>groups</code></strong>: 被授予访问权限的 <code>res.groups</code> 组, 可以指定多个组; 如果为空, 则规则是全局规则;</li><li><strong><code>global</code></strong>: 用于指定记录规则是否是全局的, 如果将 <code>global</code> 属性设置为 <code>True</code>, 则表示这条记录规则将会应用于所有用户, 而不管他们所属的用户组如何; 通常用于设置一些通用权限;</li><li><strong><code>domain_force</code></strong>: 可以用来强制性地定义一个筛选条件, 从而限制用户在查看、编辑或删除记录时的权限; 这个条件将被应用到数据库查询中, 以限制用户对特定记录的访问; 可以使用以下变量: <ul><li><strong><code>time</code></strong>: python 的 time 模块;</li><li><strong><code>user</code></strong>: 当前的用户的记录;</li><li><strong><code>company_id</code></strong>: 当前用户所选择的公司记录;</li><li><strong><code>company_ids</code></strong>: 当前用户有权访问的所有公司作为公司 ID 列表;</li></ul></li><li><strong><code>perm_{create, read, write, unlink}</code></strong>: 在设置时授予相应的 CRUD 访问权限, 默认情况下它们都是未设置的;</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>website_designer_edit_qweb<span class="token punctuation">&quot;</span></span> <span class="token attr-name">model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ir.rule<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>website_designer: Manage Website and qWeb view<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>model_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.model_ir_ui_view<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>domain_force<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>[(&#39;type&#39;, &#39;=&#39;, &#39;qweb&#39;)]<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>groups<span class="token punctuation">&quot;</span></span> <span class="token attr-name">eval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[(4, ref(&#39;group_website_designer&#39;))]<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>perm_read<span class="token punctuation">&quot;</span></span> <span class="token attr-name">eval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>True<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>perm_write<span class="token punctuation">&quot;</span></span> <span class="token attr-name">eval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>True<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>perm_create<span class="token punctuation">&quot;</span></span> <span class="token attr-name">eval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>True<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>perm_unlink<span class="token punctuation">&quot;</span></span> <span class="token attr-name">eval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>True<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="全局规则和组" tabindex="-1"><a class="header-anchor" href="#全局规则和组" aria-hidden="true">#</a> 全局规则和组</h2><p>全局规则和组规则在如何组成和组合方面存在很大差异:</p><ul><li>全局规则相交, 如果应用两个全局规则, 则必须满足两个全局规则才能授予访问权限, 这意味着添加全局规则总是会进一步限制访问;</li><li>组规则统一, 如果应用两个组规则, 则可以满足任一组规则来授予访问权限; 这意味着添加组规则可以扩展访问权限, 但不能超出全局规则定义的范围;</li><li>全局规则集和组规则集相交, 这意味着添加到给定全局规则集的第一个组规则将限制访问;</li></ul><p>以上这些规则记录都可以在 <code>Setting</code> --&gt; <code>Users &amp; Companies</code> --&gt; <code>Groups</code> 里面看到, 下面的选项卡中对应的就是视图规则, 权限规则, 和记录规则;</p><p><img src="`+c+`" alt="access-rules"></p><h2 id="字段权限" tabindex="-1"><a class="header-anchor" href="#字段权限" aria-hidden="true">#</a> 字段权限</h2><p>ORM 的 <code>field</code> 字段可以有一个 <code>groups</code> 属性提供组列表, 多个分组以 <code>,</code> 隔开;</p><p>如果当前用户不在列出的组中, 他将无权访问该字段:</p><ul><li>受限制字段将从请求的视图中自动删除;</li><li>受限制字段从模型方法 <code>fields_get()</code> 响应中删除;</li><li>尝试读取或者是写入受限字段会导致访问错误;</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>view_account_group_tree<span class="token punctuation">&quot;</span></span> <span class="token attr-name">model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ir.ui.view<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>account.group.tree<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>model<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>account.group<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>arch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tree</span> <span class="token attr-name">string</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Account Group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code_prefix_start<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code_prefix_end<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>company_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">groups</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base.group_multi_company<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tree</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安全陷阱" tabindex="-1"><a class="header-anchor" href="#安全陷阱" aria-hidden="true">#</a> 安全陷阱</h2><p>作为开发人员, 了解安全机制并避免导致代码不安全的常见错误是非常重要的;</p><h3 id="不安全的公共方法" tabindex="-1"><a class="header-anchor" href="#不安全的公共方法" aria-hidden="true">#</a> 不安全的公共方法</h3><p>任何公共方法都可以通过使用所选参数的 RPC 调用来执行, 以 <code>_</code> 开头的方法无法从操作按钮或外部 API 调用;</p><p>以 <code>_</code> 命名的方法会被标记为私有方法, 是不能通过 <code>rpc</code> 来进行调用的, 但是是可以被其他 python 代码来进行引用执行的, 因此也需要注意在方法内部的 CRUD 调用;</p><h3 id="绕过-orm" tabindex="-1"><a class="header-anchor" href="#绕过-orm" aria-hidden="true">#</a> 绕过 ORM</h3><p>当 ORM 可以做同样的事情的时候, 就优先使用 ORM 提供的方法; 而不直接使用原生 sql 语句查询, 因为直接允许 sql 会绕过所有的 orm 检查, 包括上面的权限规则和记录规则;</p><h3 id="sql-注入" tabindex="-1"><a class="header-anchor" href="#sql-注入" aria-hidden="true">#</a> sql 注入</h3><p>在使用手动 sql 查询时, 必须注意 sql 注入漏洞; 当用户在输入错误的筛选或者引用时候, 就会出现该漏洞, 从而允许攻击者在 sql 查询中引入不需要的子句(例如: 绕过筛选器或者执行 UPDATE, DELETE 命令);</p><p>最好的安全方法时永远不要使用 python 的 <code>+</code> 或者是字符串插值 <code>%</code> 将变量传递给 sql 查询字符串;</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># 错误的示例</span>
self<span class="token punctuation">.</span>env<span class="token punctuation">.</span>cr<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&#39;SELECT distinct child_id FROM account_account_consol_rel &#39;</span> <span class="token operator">+</span>
           <span class="token string">&#39;WHERE parent_id IN (&#39;</span><span class="token operator">+</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> ids<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&#39;)&#39;</span><span class="token punctuation">)</span>

<span class="token comment"># 正确的示例</span>
self<span class="token punctuation">.</span>env<span class="token punctuation">.</span>cr<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&#39;SELECT DISTINCT child_id &#39;</span>\\
           <span class="token string">&#39;FROM account_account_consol_rel &#39;</span>\\
           <span class="token string">&#39;WHERE parent_id IN %s&#39;</span><span class="token punctuation">,</span>
           <span class="token punctuation">(</span><span class="token builtin">tuple</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,58),i=[u];function r(k,d){return n(),s("div",null,i)}const v=a(l,[["render",r],["__file","权限安全.html.vue"]]);export{v as default};
