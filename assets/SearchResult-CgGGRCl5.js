import{f as N,u as Z,g as T,h as ee,P as se,t as te,i as oe,j as x,k as f,l as t,m as re,n as j,p as ae,R as P,q as le,s as ie,v as ue,x as ne,y as ce,z as $,A as I,C as ve,B as pe,D as de,E as he,F as Ee,G as me,H as ye,I as _,J as ge,K as H}from"./app-cr7GvDUH.js";const we=["/","/pages/web-server/odoo/","/pages/web-server/odoo/todo-list.html","/pages/web-server/odoo/section-01/API.html","/pages/web-server/odoo/section-01/Manifest.html","/pages/web-server/odoo/section-01/Qweb%E6%8A%A5%E8%A1%A8.html","/pages/web-server/odoo/section-01/%E5%8A%A8%E4%BD%9C.html","/pages/web-server/odoo/section-01/%E5%9F%BA%E6%9C%AC%E5%AD%97%E6%AE%B5.html","/pages/web-server/odoo/section-01/%E5%9F%BA%E6%9C%AC%E8%A7%86%E5%9B%BE.html","/pages/web-server/odoo/section-01/%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6.html","/pages/web-server/odoo/section-01/%E6%A8%A1%E5%9E%8B.html","/pages/web-server/odoo/section-01/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html","/pages/web-server/odoo/section-01/%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%A8%A1%E5%9D%97.html","/pages/web-server/odoo/section-02/Mixin.html","/pages/web-server/odoo/section-02/Qweb.html","/pages/web-server/odoo/section-02/Xpath.html","/pages/web-server/odoo/section-02/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AD%97%E6%AE%B5%E4%B8%8E%E9%99%84%E4%BB%B6.html","/pages/web-server/odoo/section-02/%E5%9B%BD%E9%99%85%E5%8C%96.html","/pages/web-server/odoo/section-02/%E6%8E%A7%E5%88%B6%E5%99%A8.html","/pages/web-server/odoo/section-02/%E6%9D%83%E9%99%90%E5%AE%89%E5%85%A8.html","/pages/web-server/odoo/section-02/%E7%BB%A7%E6%89%BF.html","/pages/web-server/odoo/section-02/%E8%8F%9C%E5%8D%95.html","/pages/web-server/odoo/section-03/Assets.html","/pages/web-server/odoo/section-03/Hooks.html","/pages/web-server/odoo/section-03/JavaScript%E6%A8%A1%E5%9D%97.html","/pages/web-server/odoo/section-03/Javascript%E6%8C%87%E5%8D%97.html","/pages/web-server/odoo/section-03/OWL%20Components.html","/pages/web-server/odoo/section-03/Patch.html","/pages/web-server/odoo/section-03/Registries.html","/pages/web-server/odoo/section-03/Services.html","/pages/web-server/odoo/section-03/%E6%A1%86%E6%9E%B6%E6%A6%82%E8%BF%B0.html","/404.html","/pages/web-server/","/pages/","/pages/web-server/odoo/section-01/","/pages/web-server/odoo/section-02/","/pages/web-server/odoo/section-03/"],Ae="SEARCH_PRO_QUERY_HISTORY",m=_(Ae,[]),be=()=>{const{queryHistoryCount:r}=H;return{enabled:r>0,queryHistory:m,addQueryHistory:i=>{m.value=Array.from(new Set([i,...m.value.slice(0,r-1)]))},removeQueryHistory:i=>{m.value=[...m.value.slice(0,i),...m.value.slice(i+1)]}}},q=r=>we[r.id]+("anchor"in r?`#${r.anchor}`:""),Be="SEARCH_PRO_RESULT_HISTORY",{resultHistoryCount:O}=H,y=_(Be,[]),fe=()=>({enabled:O>0,resultHistory:y,addResultHistory:a=>{{const i={link:q(a),display:a.display};"header"in a&&(i.header=a.header),y.value=[i,...y.value.slice(0,O-1)]}},removeResultHistory:a=>{y.value=[...y.value.slice(0,a),...y.value.slice(a+1)]}}),He=r=>{const a=ve(),i=T(),C=pe(),u=x(0),g=f(()=>u.value>0),p=de([]);return he(()=>{const{search:R,terminate:d}=Ee(),w=me(E=>{const A=E.join(" "),{searchFilter:h=o=>o,splitWord:F,suggestionsFilter:l,...n}=a.value;A?(u.value+=1,R(E.join(" "),i.value,n).then(o=>h(o,A,i.value,C.value)).then(o=>{u.value-=1,p.value=o}).catch(o=>{console.warn(o),u.value-=1,u.value||(p.value=[])})):p.value=[]},H.searchDelay-H.suggestDelay);j([r,i],([E])=>w(E),{immediate:!0}),ye(()=>{d()})}),{isSearching:g,results:p}};var Re=N({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(r,{emit:a}){const i=Z(),C=T(),u=ee(se),{addQueryHistory:g,queryHistory:p,removeQueryHistory:R}=be(),{resultHistory:d,addResultHistory:w,removeResultHistory:E}=fe(),A=te(r,"queries"),{results:h,isSearching:F}=He(A),l=oe({isQuery:!0,index:0}),n=x(0),o=x(0),S=f(()=>p.value.length>0||d.value.length>0),D=f(()=>h.value.length>0),k=f(()=>h.value[n.value]||null),M=()=>{const{isQuery:e,index:s}=l;s===0?(l.isQuery=!e,l.index=e?d.value.length-1:p.value.length-1):l.index=s-1},U=()=>{const{isQuery:e,index:s}=l;s===(e?p.value.length-1:d.value.length-1)?(l.isQuery=!e,l.index=0):l.index=s+1},J=()=>{n.value=n.value>0?n.value-1:h.value.length-1,o.value=k.value.contents.length-1},Y=()=>{n.value=n.value<h.value.length-1?n.value+1:0,o.value=0},z=()=>{o.value<k.value.contents.length-1?o.value+=1:Y()},G=()=>{o.value>0?o.value-=1:J()},Q=e=>e.map(s=>ge(s)?s:t(s[0],s[1])),K=e=>{if(e.type==="customField"){const s=ne[e.index]||"$content",[c,B=""]=ce(s)?s[C.value].split("$content"):s.split("$content");return e.display.map(v=>t("div",Q([c,...v,B])))}return e.display.map(s=>t("div",Q(s)))},b=()=>{n.value=0,o.value=0,a("updateQuery",""),a("close")},V=()=>t("ul",{class:"search-pro-result-list"},t("li",{class:"search-pro-result-list-item"},[t("div",{class:"search-pro-result-title"},u.value.queryHistory),p.value.map((e,s)=>t("div",{class:["search-pro-result-item",{active:l.isQuery&&l.index===s}],onClick:()=>{a("updateQuery",e)}},[t($,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},e),t("button",{class:"search-pro-remove-icon",innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),R(s)}})]))])),W=()=>t("ul",{class:"search-pro-result-list"},t("li",{class:"search-pro-result-list-item"},[t("div",{class:"search-pro-result-title"},u.value.resultHistory),d.value.map((e,s)=>t(P,{to:e.link,class:["search-pro-result-item",{active:!l.isQuery&&l.index===s}],onClick:()=>{b()}},()=>[t($,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},[e.header?t("div",{class:"content-header"},e.header):null,t("div",e.display.map(c=>Q(c)).flat())]),t("button",{class:"search-pro-remove-icon",innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),E(s)}})]))]));return re("keydown",e=>{if(r.isFocusing){if(D.value){if(e.key==="ArrowUp")G();else if(e.key==="ArrowDown")z();else if(e.key==="Enter"){const s=k.value.contents[o.value];g(r.queries.join(" ")),w(s),i.push(q(s)),b()}}else if(e.key==="ArrowUp")M();else if(e.key==="ArrowDown")U();else if(e.key==="Enter"){const{index:s}=l;l.isQuery?(a("updateQuery",p.value[s]),e.preventDefault()):(i.push(d.value[s].link),b())}}}),j([n,o],()=>{var e;(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>t("div",{class:["search-pro-result-wrapper",{empty:r.queries.length?!D.value:!S.value}],id:"search-pro-results"},r.queries.length?F.value?t(ae,{hint:u.value.searching}):D.value?t("ul",{class:"search-pro-result-list"},h.value.map(({title:e,contents:s},c)=>{const B=n.value===c;return t("li",{class:["search-pro-result-list-item",{active:B}]},[t("div",{class:"search-pro-result-title"},e||u.value.defaultTitle),s.map((v,X)=>{const L=B&&o.value===X;return t(P,{to:q(v),class:["search-pro-result-item",{active:L,"aria-selected":L}],onClick:()=>{g(r.queries.join(" ")),w(v),b()}},()=>[v.type==="text"?null:t(v.type==="title"?le:v.type==="heading"?ie:ue,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},[v.type==="text"&&v.header?t("div",{class:"content-header"},v.header):null,t("div",K(v))])])})])})):u.value.emptyResult:S.value?[V(),W()]:u.value.emptyHistory)}});export{Re as default};
