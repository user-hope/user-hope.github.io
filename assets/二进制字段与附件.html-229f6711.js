import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as s,c as a,e as t}from"./app-9b0cd270.js";const p="/images/odoo/S15/attacment.png",i={},e=t('<h2 id="二进制字段" tabindex="-1"><a class="header-anchor" href="#二进制字段" aria-hidden="true">#</a> 二进制字段</h2><p>二进制字段, 实际上代表了 odoo 中的一类二进制文件, 像普通的文件, 图片, 视频等; 而附件则是指 odoo 中上传的文件以及编译后生成的 js, css 等文件, 对应的附件 <code>ir.attachment</code> 对象, 二进制字段的底层实现使用了附件, 因此二进制字段的行为表现跟附件基本一致;</p><p>我们可以在 <code>设置</code> --&gt; <code>技术设置</code> --&gt; <code>数据结构</code> --&gt; <code>附件</code> 中查看所有附件的详细信息, 通常会包含附件的名称、类型、MIME类型、文件路径等信息;</p><p><img src="'+p+`" alt="attachment"></p><p>默认情况下文件存储在应用服务器的上, 用户可以通过在技术参数中新增一个参数 <code>ir_attachment.location</code>, 并将值设置为 <code>db</code> 来告诉odoo将附件的存储位置更改为数据库存储;</p><blockquote><p>具体实现可以查看源码 odoo/addons/base/models/ir_attachment.py</p></blockquote><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token decorator annotation punctuation">@api<span class="token punctuation">.</span>model</span>
    <span class="token keyword">def</span> <span class="token function">_storage</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">&#39;ir.config_parameter&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sudo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">&#39;ir_attachment.location&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;file&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>附件文件的存储路径我们可以通过配置文件中的 <code>data_dir</code> 参数来指定. <code>data_dir</code> 指定的路径下通常有三个文件夹, 分别为 <code>addons</code>、<code>session</code> 和 <code>files</code>, 其中 <code>files</code> 就是附件存储的路径;</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># odoo.conf</span>

data_dir <span class="token operator">=</span> C<span class="token punctuation">:</span>\\Users\\xxx\\local\\data
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="附件的特性" tabindex="-1"><a class="header-anchor" href="#附件的特性" aria-hidden="true">#</a> 附件的特性</h2><h3 id="类型" tabindex="-1"><a class="header-anchor" href="#类型" aria-hidden="true">#</a> 类型</h3><p>默认的附件有两种类型可选:</p><ul><li><strong><code>url</code></strong>: 以 URL 形式存储的附件;</li><li><strong><code>binary</code></strong>: 以二进制文件存储的附件;</li></ul><p>这就是说, 文件支持两种方式的上传, 一种是直接上传二进制文件, 另外一种是直接输入文件的URL地址. 直接上传二进制的文件会被存放在前面提到过的存储文件夹中, URL一般是模块自带的静态文件;</p><p>相应的, 如果附件是 <code>url</code> 类型, 那么可以通过 <code>url</code> 字段获取附件的 <code>URL</code> 地址. 如果附件是 <code>binary</code> 类型, 则可以通过 <code>datas</code> 获取附件的二进制内容;</p><h3 id="多媒体文件类型" tabindex="-1"><a class="header-anchor" href="#多媒体文件类型" aria-hidden="true">#</a> 多媒体文件类型</h3><p>如果附件是多媒体类型文件, 那么系统在附件上传以后会自动检测其相应的文件类型, 并存储在 <code>mimetype</code> 字段中, 常见的 <code>mimetype</code> 列表:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">_default_mime_types</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> suffix_map<span class="token punctuation">,</span> _suffix_map_default
    <span class="token keyword">global</span> encodings_map<span class="token punctuation">,</span> _encodings_map_default
    <span class="token keyword">global</span> types_map<span class="token punctuation">,</span> _types_map_default
    <span class="token keyword">global</span> common_types<span class="token punctuation">,</span> _common_types_default

    suffix_map <span class="token operator">=</span> _suffix_map_default <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&#39;.svgz&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;.svg.gz&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.tgz&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;.tar.gz&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.taz&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;.tar.gz&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.tz&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;.tar.gz&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.tbz2&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;.tar.bz2&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.txz&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;.tar.xz&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

    encodings_map <span class="token operator">=</span> _encodings_map_default <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&#39;.gz&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;gzip&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.Z&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;compress&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.bz2&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;bzip2&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.xz&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;xz&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.br&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;br&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

    <span class="token comment"># Before adding new types, make sure they are either registered with IANA,</span>
    <span class="token comment"># at http://www.iana.org/assignments/media-types</span>
    <span class="token comment"># or extensions, i.e. using the x- prefix</span>

    <span class="token comment"># If you add to these, please keep them sorted by mime type.</span>
    <span class="token comment"># Make sure the entry with the preferred file extension for a particular mime type</span>
    <span class="token comment"># appears before any others of the same mimetype.</span>
    types_map <span class="token operator">=</span> _types_map_default <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&#39;.js&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;text/javascript&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.mjs&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;text/javascript&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.json&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;application/json&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.webmanifest&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;application/manifest+json&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.doc&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/msword&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.dot&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/msword&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.wiz&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/msword&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.nq&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;application/n-quads&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.nt&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;application/n-triples&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.bin&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/octet-stream&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.a&#39;</span>      <span class="token punctuation">:</span> <span class="token string">&#39;application/octet-stream&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.dll&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/octet-stream&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.exe&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/octet-stream&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.o&#39;</span>      <span class="token punctuation">:</span> <span class="token string">&#39;application/octet-stream&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.obj&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/octet-stream&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.so&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;application/octet-stream&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.oda&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/oda&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.pdf&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/pdf&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.p7c&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/pkcs7-mime&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.ps&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;application/postscript&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.ai&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;application/postscript&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.eps&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/postscript&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.trig&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;application/trig&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.m3u&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/vnd.apple.mpegurl&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.m3u8&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;application/vnd.apple.mpegurl&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.xls&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/vnd.ms-excel&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.xlb&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/vnd.ms-excel&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.ppt&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/vnd.ms-powerpoint&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.pot&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/vnd.ms-powerpoint&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.ppa&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/vnd.ms-powerpoint&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.pps&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/vnd.ms-powerpoint&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.pwz&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/vnd.ms-powerpoint&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.wasm&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;application/wasm&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.bcpio&#39;</span>  <span class="token punctuation">:</span> <span class="token string">&#39;application/x-bcpio&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.cpio&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;application/x-cpio&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.csh&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-csh&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.dvi&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-dvi&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.gtar&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;application/x-gtar&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.hdf&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-hdf&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.h5&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;application/x-hdf5&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.latex&#39;</span>  <span class="token punctuation">:</span> <span class="token string">&#39;application/x-latex&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.mif&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-mif&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.cdf&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-netcdf&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.nc&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;application/x-netcdf&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.p12&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-pkcs12&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.pfx&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-pkcs12&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.ram&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-pn-realaudio&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.pyc&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-python-code&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.pyo&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-python-code&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.sh&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;application/x-sh&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.shar&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;application/x-shar&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.swf&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-shockwave-flash&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.sv4cpio&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;application/x-sv4cpio&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.sv4crc&#39;</span> <span class="token punctuation">:</span> <span class="token string">&#39;application/x-sv4crc&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.tar&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-tar&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.tcl&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-tcl&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.tex&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-tex&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.texi&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;application/x-texinfo&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.texinfo&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;application/x-texinfo&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.roff&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;application/x-troff&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.t&#39;</span>      <span class="token punctuation">:</span> <span class="token string">&#39;application/x-troff&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.tr&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;application/x-troff&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.man&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-troff-man&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.me&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;application/x-troff-me&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.ms&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;application/x-troff-ms&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.ustar&#39;</span>  <span class="token punctuation">:</span> <span class="token string">&#39;application/x-ustar&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.src&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/x-wais-source&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.xsl&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/xml&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.rdf&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/xml&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.wsdl&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;application/xml&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.xpdl&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;application/xml&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.zip&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;application/zip&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.3gp&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;audio/3gpp&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.3gpp&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;audio/3gpp&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.3g2&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;audio/3gpp2&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.3gpp2&#39;</span>  <span class="token punctuation">:</span> <span class="token string">&#39;audio/3gpp2&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.aac&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;audio/aac&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.adts&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;audio/aac&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.loas&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;audio/aac&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.ass&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;audio/aac&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.au&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;audio/basic&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.snd&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;audio/basic&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.mp3&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;audio/mpeg&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.mp2&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;audio/mpeg&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.opus&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;audio/opus&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.aif&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;audio/x-aiff&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.aifc&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;audio/x-aiff&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.aiff&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;audio/x-aiff&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.ra&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;audio/x-pn-realaudio&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.wav&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;audio/x-wav&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.avif&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;image/avif&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.bmp&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/bmp&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.gif&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/gif&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.ief&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/ief&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.jpg&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/jpeg&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.jpe&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/jpeg&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.jpeg&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;image/jpeg&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.heic&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;image/heic&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.heif&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;image/heif&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.png&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/png&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.svg&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/svg+xml&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.tiff&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;image/tiff&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.tif&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/tiff&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.ico&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/vnd.microsoft.icon&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.ras&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/x-cmu-raster&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.pnm&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/x-portable-anymap&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.pbm&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/x-portable-bitmap&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.pgm&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/x-portable-graymap&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.ppm&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/x-portable-pixmap&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.rgb&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/x-rgb&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.xbm&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/x-xbitmap&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.xpm&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/x-xpixmap&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.xwd&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;image/x-xwindowdump&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.eml&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;message/rfc822&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.mht&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;message/rfc822&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.mhtml&#39;</span>  <span class="token punctuation">:</span> <span class="token string">&#39;message/rfc822&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.nws&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;message/rfc822&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.css&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;text/css&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.csv&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;text/csv&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.html&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;text/html&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.htm&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;text/html&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.n3&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;text/n3&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.txt&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;text/plain&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.bat&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;text/plain&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.c&#39;</span>      <span class="token punctuation">:</span> <span class="token string">&#39;text/plain&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.h&#39;</span>      <span class="token punctuation">:</span> <span class="token string">&#39;text/plain&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.ksh&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;text/plain&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.pl&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;text/plain&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.srt&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;text/plain&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.rtx&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;text/richtext&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.tsv&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;text/tab-separated-values&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.vtt&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;text/vtt&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.py&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;text/x-python&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.etx&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;text/x-setext&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.sgm&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;text/x-sgml&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.sgml&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;text/x-sgml&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.vcf&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;text/x-vcard&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.xml&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;text/xml&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.mp4&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;video/mp4&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.mpeg&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;video/mpeg&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.m1v&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;video/mpeg&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.mpa&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;video/mpeg&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.mpe&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;video/mpeg&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.mpg&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;video/mpeg&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.mov&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;video/quicktime&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.qt&#39;</span>     <span class="token punctuation">:</span> <span class="token string">&#39;video/quicktime&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.webm&#39;</span>   <span class="token punctuation">:</span> <span class="token string">&#39;video/webm&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.avi&#39;</span>    <span class="token punctuation">:</span> <span class="token string">&#39;video/x-msvideo&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.movie&#39;</span>  <span class="token punctuation">:</span> <span class="token string">&#39;video/x-sgi-movie&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

    <span class="token comment"># These are non-standard types, commonly found in the wild.  They will</span>
    <span class="token comment"># only match if strict=0 flag is given to the API methods.</span>

    <span class="token comment"># Please sort these too</span>
    common_types <span class="token operator">=</span> _common_types_default <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&#39;.rtf&#39;</span> <span class="token punctuation">:</span> <span class="token string">&#39;application/rtf&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.midi&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;audio/midi&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.mid&#39;</span> <span class="token punctuation">:</span> <span class="token string">&#39;audio/midi&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.jpg&#39;</span> <span class="token punctuation">:</span> <span class="token string">&#39;image/jpg&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.pict&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;image/pict&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.pct&#39;</span> <span class="token punctuation">:</span> <span class="token string">&#39;image/pict&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.pic&#39;</span> <span class="token punctuation">:</span> <span class="token string">&#39;image/pict&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.webp&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;image/webp&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;.xul&#39;</span> <span class="token punctuation">:</span> <span class="token string">&#39;text/xul&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="其他附件信息" tabindex="-1"><a class="header-anchor" href="#其他附件信息" aria-hidden="true">#</a> 其他附件信息</h3><p>附件中, 还有一些其他的字段, 描述附件的相关信息:</p><ul><li><strong><code>access_token</code></strong>: 用于公开访问的 <code>token</code>;</li><li><strong><code>checksum</code></strong>: 校验和/SHA1;</li><li><strong><code>datas_fname</code></strong>: 附件的文件名;</li><li><strong><code>file_size</code></strong>: 附件文件的大小;</li><li><strong><code>public</code></strong>: 是否公开;</li><li><strong><code>res_model</code></strong>: 关联的模型名称;</li><li><strong><code>res_field</code></strong>: 关联的字段名称;</li><li><strong><code>res_id</code></strong>: 关联的记录ID;</li></ul><p>其中 <code>res_field</code> 是与二进制字段相关的内容, <code>res_model</code> 指明附件是在哪个模型下上传的, <code>res_id</code> 指明该模型的记录信息, 这样就能定位到具体是哪个模型的哪个记录附加的附件;</p><p><strong><code>datas</code> 与 <code>db_datas</code></strong></p><p>附件有两个字段 <code>datas</code> 与 <code>db_datas</code>, <code>datas</code> 是经过 <code>base64</code> 加密后的值, 而 <code>db_datas</code> 是存储于数据库中的二进制值.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token decorator annotation punctuation">@api<span class="token punctuation">.</span>depends</span><span class="token punctuation">(</span><span class="token string">&#39;store_fname&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;db_datas&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;file_size&#39;</span><span class="token punctuation">)</span>
    <span class="token decorator annotation punctuation">@api<span class="token punctuation">.</span>depends_context</span><span class="token punctuation">(</span><span class="token string">&#39;bin_size&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">_compute_datas</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_context<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;bin_size&#39;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> attach <span class="token keyword">in</span> self<span class="token punctuation">:</span>
                attach<span class="token punctuation">.</span>datas <span class="token operator">=</span> human_size<span class="token punctuation">(</span>attach<span class="token punctuation">.</span>file_size<span class="token punctuation">)</span>
            <span class="token keyword">return</span>

        <span class="token keyword">for</span> attach <span class="token keyword">in</span> self<span class="token punctuation">:</span>
            attach<span class="token punctuation">.</span>datas <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>attach<span class="token punctuation">.</span>raw <span class="token keyword">or</span> <span class="token string">b&#39;&#39;</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@api<span class="token punctuation">.</span>depends</span><span class="token punctuation">(</span><span class="token string">&#39;store_fname&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;db_datas&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">_compute_raw</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> attach <span class="token keyword">in</span> self<span class="token punctuation">:</span>
        <span class="token keyword">if</span> attach<span class="token punctuation">.</span>store_fname<span class="token punctuation">:</span>
            attach<span class="token punctuation">.</span>raw <span class="token operator">=</span> attach<span class="token punctuation">.</span>_file_read<span class="token punctuation">(</span>attach<span class="token punctuation">.</span>store_fname<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            attach<span class="token punctuation">.</span>raw <span class="token operator">=</span> attach<span class="token punctuation">.</span>db_datas
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="附件的访问权限" tabindex="-1"><a class="header-anchor" href="#附件的访问权限" aria-hidden="true">#</a> 附件的访问权限</h3><p>附件的访问权限分为两种, 一种是可以公开访问的, 直接通过URL可以读取. 另外一种是只能够拥有访问 <code>token</code> 的人才可以读取;</p><p>有时候我们希望将附件共享给他人, 包括且不限于内部用户, 门户用户, 甚至游客; 但出于安全性的考虑, 我们不能生成一个公开的链接让所有拥有连接的人进行访问;</p><p>所以 odoo 的附件提供了一个附件 <code>access token</code> 的方法, 即 <code>generate_access_token</code>; 凡是拥有这个 token 的人可以访问, 否则就不能访问; 生成 <code>access token</code> 方法即调用附件的 <code>generate_access_token</code>, 该方法会在附件对象上生成一个 uuid 的随机字符串;</p><p>可以生成以下的链接来访问附件:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token punctuation">{</span>host<span class="token punctuation">}</span><span class="token operator">/</span>web<span class="token operator">/</span>content?<span class="token builtin">id</span><span class="token operator">=</span><span class="token punctuation">{</span>attachment<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span><span class="token operator">&amp;</span>download<span class="token operator">=</span>true<span class="token operator">&amp;</span>access_token<span class="token operator">=</span><span class="token punctuation">{</span>attachment<span class="token punctuation">.</span>generate_access_token<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,31),c=[e];function o(l,u){return s(),a("div",null,c)}const d=n(i,[["render",o],["__file","二进制字段与附件.html.vue"]]);export{d as default};
