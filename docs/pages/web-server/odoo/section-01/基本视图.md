---
headerDepth: 3
prev:
  link: /pages/web-server/odoo/section-01/基本字段.md
next:
  link: /pages/web-server/odoo/section-01/API.md
---

## 视图

视图定义了如何向终端用户展示记录; 它们是用 `xml` 指定的, 并不需要我们自己写 `html` 代码, 这对于经常开发后端的同学是非常友好的; 我们只需要按照它的要求的格式进行拼装 `xml`, 前端页面就会自动生成; 比如: 第一个模块里面, 我们就使用了 列表和表单视图对图书应用进行编辑和查看;

因为视图是前端展示用的, 所以视图的种类多种多样, odoo 也可以支持自定义视图, 这就给了开发人员很大的灵活拓展性;

## 通用结构

odoo 的所有视图基本上都是使用下面的结构进行定义的:

```xml
<record id="MODEL_view_TYPE" model="ir.ui.view">
    <field name="name">NAME</field>
    <field name="model">MODEL</field>
    <field name="arch" type="xml">
        <VIEW_TYPE>
            <VIEW_SPECIFICATIONS/>
        </VIEW_TYPE>
    </field>
</record>
```
在 odoo 中, 所有的预定义的数据结构都放在 `<record>` 节点中, `id` 是这些数据的唯一标识, 又叫做 `xml id`; `xml id`在模块内部是唯一的; 

`model` 指明为所属对象的模型名称, odoo 中的视图模型是 `ir.ui.view`, 因此这里是 `ir.ui.view`;

`<record>` 的子节点, 由若干个 `<field>` 组成, 其中:
- `name`: 视图的名称; 例如: 图书的表单视图定义为: `<field name="name">Book Form</field>`
- `model`: 视图所属的模型名称, 用于链接模型; 例如: 图书的表单视图定义为 `<field name="model">library.book</field>`, `library.book` 就是图书模型的名称;
- `priority`: 优先级; 一个模型可以绑定多个视图, 默认点击打开的视图为优先级最低的;
- `groups_id`: `Many2many` 关联 `base.models.res_users.Groups`; 表示允许访问当前视图的用户组;
- `arch`:  视图的布局结构, 属性 `type` 为固定值 `xml`;

## 视图类型

上面的通用结构里面的 `VIEW_TYPE` 为 odoo 的视图类型, odoo 内置的视图类型有:
- `activity`: 活动视图, 用于显示链接到记录的活动, 数据显示在图表中, 记录形成行, 活动类型形成列;
- `calendar`: 日历视图, 日历视图将记录显示为日、周、月或年日历中的事件;
- `form`: 表单视图, 用于编辑/展示记录中的单条数据; 它们由带有附加结构和语义组件的常规HTML组成;
- `gantt`: 甘特图, 用于日程安排;
- `graph`: 图表展示;
- `kanban`: 看板视图; 它将记录集展示为卡片, 介于列表视图和不可编辑的表单视图之间;
- `list(tree)`: 列表视图;
- `pivot`:  透视视图用于将聚合可视化为透视表;
- `qweb`: `qweb` 视图是标准的 `qweb` 模板在视图的 `arch` 下, 它们没有特定的根元素;
- `search`: 搜索视图, 一般是和 `tree` 视图一起组合使用;

## 视图的属性

不同的视图类型具有各种各样的属性, 允许自定义通用行为; 这里列出一些主要的属性, 它们并不会对所有的视图类型产生影响;

- `create`: 禁用/启用视图上的记录创建;
- `edit`: 作用于 `form`, `tree`, `gantt` 视图; 禁用/启用记录编辑功能;
- `delete`: 作用于 `form`, `list`; 禁用/启用 actions 下拉操作里面的删除记录的功能;
- `duplicate`: 作用于 `form`; 禁用/启用 actions 下拉操作里面的复制记录的功能;
- `decoration-{$name}`: 作用于 `list`, `gantt` 视图, 对于每条记录, 将使用记录的属性作为上下文值来计算表达式, 如果为 true,则将相应的样式应用于行;
- `js_class`: 扩展视图的 MVC 功能, 这个功能点比较多, 后面有章节来介绍;

```xml
<tree decoration-info="state == 'draft'" decoration-danger="state == 'help_needed'" decoration-bf="state='busy'">
    <!-- TREE_VIEW_CONTENT -->
</tree>
```
注意: 
- `gantt` 图可使用的 `name` 为: `success`, `info`, `warning`, `danger`, `secondary`;
- `tree` 视图可使用的 `name` 为: `bf`, `it`, `success`, `info`, `warning`, `danger`, `muted`, `primary`

odoo 的常用视图类型就上面这些, 除了一些通用的属性, 还有一些视图独有的属性, 下面我们就来看一下每个视图的作用以及用法;

## Activity

活动视图与看板非常的相似; 每一行的第一个单元格显示一张代表相应记录的卡片, 单击其他单元格时, 将显示该记录的所有相同类型活动的详细描述;

活动视图的根元素是 `<activity>`, 它接受下面的属性:
- `string`: 标题;

视图的子元素:
- `<field>`: 声明要在活动逻辑中使用的字段, 如果该字段只是显示在活动视图中, 则不需要预先声明;
- `<templates>`: 定义 `qweb` 模板, 为了清晰起见, 卡片定义可以拆分为多个模板, 但活动视图必须至少定义一个根模板 `activity-box`, 每个记录将呈现一次;


```xml
<record id="crm_lead_view_activity" model="ir.ui.view">
    <field name="name">crm.lead.view.activity</field>
    <field name="model">crm.lead</field>
    <field name="arch" type="xml">
        <activity string="Leads or Opportunities">
            <field name="user_id"/>
            <field name="company_currency"/>
            <templates>
                <div t-name="activity-box">
                    <field name="user_id" widget="many2one_avatar_user"/>
                    <div>
                        <field name="name" display="full"/>
                        <field name="expected_revenue" widget="monetary" display="full" muted="1"/>
                    </div>
                </div>
            </templates>
        </activity>
    </field>
</record>
```
![activity-view](/images/odoo/S04/activity_view.png)

## Calendar

默认情况下, 日历视图将以当前日期 (今天) 为中心. 用户可以讲特定的初始日期 `initial_date` 传递给操作的上下文, 以便将日历的初始焦点设置在该日期的前后的时间段;

活动视图的根元素是 `<calendar>`, 它接受下面的属性:
- `string`: 标题;
- `date_start`: 必填, 保存事件的开始日期;
- `date_stop`: 保存事件结束日期, 如果提供了 `date_stop`, 则记录可以直接在日历中拖拽移动;
- `date_delay`: `datestop` 的替代项, 提供事件的持续时间, 而不是结束日期; (单位: 天)
- `color`: 用于分隔记录字段的颜色; 
- `form_view_id`: 用户点击创建/编辑时打开的视图的 `xml id`; 
- `event_open_popup`: 如果设置为 true, 则日历视图将在 `FormViewDialog` 中打开, 否则使用 `do_action` 在新表单视图中打开; 
- `quick_add`: 启用单击时的快速创建: 只要求用户输入名称, (可以通过 _rec_name 控制保存该字段的值), 并尝试使用该名称和单击事件的时间创建新事件;
- `create_name_field`: 设置保存文本的字段, 当通过快速创建机制的时候生效;
- `all_day`: 相应的事件是否标记为一天;
- `mode`: 加载日历时的默认显示模式; 可选: `day`, `week`, `month`, `year`;
- `scales`: 用于控制日历的显示细节和范围; 指定了日历视图的初始显示模式和可供选择的时间刻度; 可选: `day`, `week`, `month`, `year`;
- `create, delete`: 禁用/启用 事件的创建/编辑;

视图的子元素:
- `<field>`: 在看板逻辑中使用的字段, 字段可以接收下面的属性:
    - `invisible`: 隐藏;
    - `avatar_field`: 仅用于 `x2many` 字段, 以显示卡片而不是 `display_name`;
    - `write_model, write_field, filter_field`: 可以添加一个过滤器并将结果保存在定义的模型中, 过滤器会添加在侧边栏中;
    - `filters, color`: 在侧边栏的过滤器中添加此字段, 可以指定用于为复选框着色的颜色字段;

```xml
<record id="crm_case_calendar_view_leads" model="ir.ui.view">
    <field name="name">crm.lead.calendar.lead</field>
    <field name="model">crm.lead</field>
    <field name="priority" eval="2"/>
    <field name="arch" type="xml">
        <calendar string="Leads Generation" create="0" mode="month" date_start="activity_date_deadline" color="user_id" hide_time="true" event_limit="5">
            <field name="expected_revenue"/>
            <field name="partner_id" avatar_field="avatar_128"/>
            <field name="user_id" filters="1" invisible="1"/>
        </calendar>
    </field>
</record>
```
![calendar_view](/images/odoo/S04/calendar_view.png)


## Form

表单视图用于显示单个记录中的数据, 它的根元素是 `<form>`, 由解构元素和部分 HTML 元素组成;

结构元素是 odoo 封装的一些 html 组件, 它们只是固定一些样式, 没有任何的逻辑;
- `<notebook>`: 定义了一个选项卡部分, 每个选项卡都是通过 `pages` 子元素定义的; `pages` 具以下属性:
    - `string`: 必填, tab 选项的名称;
    - `accesskey`: html 的 [accesskey](https://html.spec.whatwg.org/multipage/interaction.html#the-accesskey-attribute)
    - `attrs`: 动态属性;
- `<group>`: 用于定义窗格的布局, 默认情况下一个 `group` 显示为 2 列; 
- `<newline>`: 仅在 `group` 元素中有用, 作用是提前结束当前行, 并立即切换到新行;
- `<separator>`: 较小的水平间距, 可以设置 `string` 属性, 表现为水平间距的标题;
- `<sheet>`: 可以用作子窗体, 以纸张的样式展示窗格布局;
- `<header>`: 与 `sheet` 相结合, 在表单的头部添加工作流或者是按钮内容;
- `<button>`: 调用 odoo 模型的方法; 此外还可以设置以下属性:
    - `special`: 对于在对话框中打开的 form 视图: `save` 可保存记录, 并且关闭对话框; `cancel` 关闭对话框并丢弃;
    - `confirm`: 执行 name 定义的函数之前, 弹出来的确认消息;
- `<field>`: 展示模型中的字段, 可以接收下面的一些属性:
    - `name`: 模型中的字段名称;
    - `id`: 字段的 id; (当视图中出现多个相同的字段的时候可以指定唯一 id); 默认使用的是字段的 name 属性;
    - `widget`: 字段拥其类型的 `widget` 组件渲染, 允许使用自定义的渲染方法和上下文; **这个比较重要, 后面详细说明**;
    - `options`: json 对象, 可以指定 `widget` 的配置选项;
    - `class`: html 的 class 属性; odoo 又一些内置的 class 可以使用:
        - `oe_inline`: css 的 `display: inline-block`;
        - `oe_left, oe_right`: css 的 `float` 排版;
        - `oe_read_only, oe_edit_only`: 表单在 `readonly` 的时候可见; 表单在 `edit` 的时候可见;
        - `oe_avatar`: 对于 `Image` 类型的字段, 图片将会展示为 `90 * 90` 的方形缩略图;
    - `groups`: 指定哪些用户组可见;
    - `attrs`: 设置动态属性;
    - `domain`: 仅用于关联字段, 传入过滤条件, 过滤关联字段的数据;
    - `context`: 仅用于关联字段, 传递上下文;
    - `readonly`: 字段只读;
    - `required`: 字段为必填;
    - `nolable`: 不显示左侧的 `label` 标签;
    - `placeholder`: `input` 输入框的 `placeholder`;
    - `mode`: 仅用于 `One2many` 类型的字段, 当前的记录要显示的视图; 默认是 `tree`; 可选: `tree`, `kanban`, `form`, `graph`;
    - `help`: 鼠标移动上面的时候显示的 tooltip 提示信息;
    - `filename`: 对于二进制字段, 提供文件名的相关字段的名称;
    - `password`: Char 字段显示为密码样式;
    - `kanban_view_ref`: 用于在移动环境中从 `m2o/m2m` 中选择记录时打开特定的看板视图;
- `<label>`: 当字段没有放置在 `group` 中, 或者是设置了 `nolabel` 属性时, 字段的标签不会自动显示在旁边; `label` 标签的作用是显示字段标签的手动替代方案; 接收以下属性:
    - `for`: 与标签相关联的字段引用; 可以是字段的名称, 也可以是 `id` (字段上设置的 id 属性);  
    - `string`: label 标签显示的名称;
    - `class`: html 的 class 属性;
    - `attrs`: 动态设置属性

```xml
<record id="view_order_form" model="ir.ui.view">
    <field name="name">sale.order.form</field>
    <field name="model">sale.order</field>
    <field name="arch" type="xml">
        <form string="Sales Order" class="o_sale_order">
        <header>
            <field name="authorized_transaction_ids" invisible="1"/>
            <button name="payment_action_capture" type="object" data-hotkey="shift+g"
                    string="Capture Transaction" class="oe_highlight"
                    attrs="{'invisible': [('authorized_transaction_ids', '=', [])]}"/>
            <button name="payment_action_void" type="object"
                    string="Void Transaction" data-hotkey="shift+v"
                    confirm="Are you sure you want to void the authorized transaction? This action can't be undone."
                    attrs="{'invisible': [('authorized_transaction_ids', '=', [])]}"/>
            <button id="create_invoice" name="%(sale.action_view_sale_advance_payment_inv)d" string="Create Invoice"
                type="action" class="btn-primary" data-hotkey="q"
                attrs="{'invisible': [('invoice_status', '!=', 'to invoice')]}"/>
            <button id="create_invoice_percentage" name="%(sale.action_view_sale_advance_payment_inv)d" string="Create Invoice"
                type="action" context="{'default_advance_payment_method': 'percentage'}" data-hotkey="q"
                attrs="{'invisible': ['|',('invoice_status', '!=', 'no'), ('state', '!=', 'sale')]}"/>
            <button name="action_quotation_send" string="Send by Email" type="object" states="draft" class="btn-primary" data-hotkey="g" context="{'validate_analytic': True}"/>
            <button name="action_quotation_send" type="object" string="Send PRO-FORMA Invoice"
                groups="sale.group_proforma_sales" class="btn-primary"
                attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('invoice_count','&gt;=',1)]}" context="{'proforma': True, 'validate_analytic': True}"/>
            <button name="action_confirm" id="action_confirm" data-hotkey="v"
                string="Confirm" class="btn-primary" type="object" context="{'validate_analytic': True}"
                attrs="{'invisible': [('state', 'not in', ['sent'])]}"/>
            <button name="action_confirm" data-hotkey="v"
                string="Confirm" type="object" context="{'validate_analytic': True}"
                attrs="{'invisible': [('state', 'not in', ['draft'])]}"/>
            <button name="action_quotation_send" type="object" string="Send PRO-FORMA Invoice" groups="sale.group_proforma_sales" attrs="{'invisible': ['|', ('state', '=', 'draft'), ('invoice_count','&gt;=',1)]}" context="{'proforma': True, 'validate_analytic': True}"/>
            <button name="action_quotation_send" string="Send by Email" type="object" states="sent,sale" data-hotkey="g" context="{'validate_analytic': True}"/>
            <button name="action_cancel" type="object" string="Cancel" attrs="{'invisible': ['|', ('state', 'not in', ['draft', 'sent','sale']), ('id', '=', False)]}" data-hotkey="z"/>
            <button name="action_draft" states="cancel" type="object" string="Set to Quotation" data-hotkey="w"/>
            <field name="state" widget="statusbar" statusbar_visible="draft,sent,sale"/>
        </header>
        <div
             class="alert alert-warning mb-0" role="alert"
             attrs="{'invisible': [('partner_credit_warning', '=', '')]}">
            <field name="partner_credit_warning"/>
        </div>
        <sheet>
            <div class="oe_button_box" name="button_box">
                <button name="action_view_invoice"
                    type="object"
                    class="oe_stat_button"
                    icon="fa-pencil-square-o"
                    attrs="{'invisible': [('invoice_count', '=', 0)]}">
                    <field name="invoice_count" widget="statinfo" string="Invoices"/>
                </button>
                <button name="action_preview_sale_order"
                    type="object"
                    class="oe_stat_button"
                    icon="fa-globe icon">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_text">Customer</span>
                        <span class="o_stat_text">Preview</span>
                    </div>
                </button>
            </div>
            <div class="oe_title">
                <h1>
                    <field name="name" readonly="1"/>
                </h1>
            </div>
            <group name="sale_header">
                <group name="partner_details">
                    <field name="partner_id" widget="res_partner_many2one" context="{'res_partner_search_mode': 'customer', 'show_address': 1, 'show_vat': True}" options='{"always_reload": True}'/>
                    <field name="partner_invoice_id" groups="account.group_delivery_invoice_address" context="{'default_type':'invoice'}" options='{"always_reload": True}'/>
                    <field name="partner_shipping_id" groups="account.group_delivery_invoice_address" context="{'default_type':'delivery'}" options='{"always_reload": True}'/>
                </group>
                <group name="order_details">
                    <field name="validity_date" attrs="{'invisible': [('state', 'in', ['sale', 'done'])]}"/>
                    <div class="o_td_label" groups="base.group_no_one" attrs="{'invisible': [('state', 'in', ['sale', 'done', 'cancel'])]}">
                        <label for="date_order" string="Quotation Date"/>
                    </div>
                    <field name="date_order" nolabel="1" groups="base.group_no_one" attrs="{'invisible': [('state', 'in', ['sale', 'done', 'cancel'])]}"/>
                    <div class="o_td_label" attrs="{'invisible': [('state', 'in', ['draft', 'sent'])]}">
                        <label for="date_order" string="Order Date"/>
                    </div>
                    <field name="date_order" attrs="{'invisible': [('state', 'in', ['draft', 'sent'])]}" nolabel="1"/>
                    <field name="show_update_pricelist" invisible="1"/>
                    <label for="pricelist_id" groups="product.group_product_pricelist"/>
                    <div groups="product.group_product_pricelist" class="o_row">
                        <field name="pricelist_id" options="{'no_open':True,'no_create': True}"/>
                        <button name="action_update_prices" type="object"
                            string=" Update Prices"
                            help="Recompute all prices based on this pricelist"
                            class="btn-link mb-1 px-0" icon="fa-refresh"
                            confirm="This will update all unit prices based on the currently set pricelist."
                            attrs="{'invisible': ['|', ('show_update_pricelist', '=', False), ('state', 'in', ['sale', 'done', 'cancel'])]}"/>
                    </div>
                    <field name="company_id" invisible="1"/>
                    <field name="currency_id" invisible="1"/>
                    <field name="pricelist_id" invisible="1" groups="!product.group_product_pricelist"/>
                    <field name="tax_country_id" invisible="1"/>
                    <field name="payment_term_id" options="{'no_open':True,'no_create': True}"/>
                </group>
            </group>
            <notebook>
                <page string="Order Lines" name="order_lines">
                    <field
                        name="order_line"
                        widget="section_and_note_one2many"
                        mode="tree,kanban"
                        attrs="{'readonly': [('state', 'in', ('done','cancel'))]}"
                    >
                        <form>
                            <field name="display_type" invisible="1"/>
                            <!--
                                We need the sequence field to be here for new lines to be added at the correct position.
                                TODO: at some point we want to fix this in the framework so that an invisible field is not required.
                            -->
                            <field name="sequence" invisible="1"/>
                            <field name="product_uom_category_id" invisible="1"/>
                            <group>
                                <group attrs="{'invisible': [('display_type', '!=', False)]}">
                                    <field name="product_updatable" invisible="1"/>
                                    <field name="product_id"
                                        domain="[('sale_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                                        context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"
                                        attrs="{
                                            'readonly': [('product_updatable', '=', False)],
                                            'required': [('display_type', '=', False)],
                                        }"
                                        force_save="1"
                                        widget="many2one_barcode"
                                        />
                                    <field name="product_type" invisible="1"/>
                                    <field name="invoice_status" invisible="1"/>
                                    <field name="qty_to_invoice" invisible="1"/>
                                    <field name="qty_delivered_method" invisible="1"/>
                                    <field name="price_total" invisible="1"/>
                                    <field name="price_tax" invisible="1"/>
                                    <field name="price_subtotal" invisible="1"/>
                                    <field name="product_uom_readonly" invisible="1"/>
                                    <label for="product_uom_qty"/>
                                    <div class="o_row" name="ordered_qty">
                                        <field
                                            context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'uom_qty_change':True, 'company_id': parent.company_id}"
                                            name="product_uom_qty"/>
                                        <field name="product_uom" invisible="1" groups="!uom.group_uom"/>
                                        <field
                                            name="product_uom"
                                            force_save="1"
                                            groups="uom.group_uom"
                                            class="oe_no_button"
                                            attrs="{
                                                'readonly': [('product_uom_readonly', '=', True)],
                                                'required': [('display_type', '=', False)],
                                            }"
                                        />
                                    </div>
                                    <label for="qty_delivered" string="Delivered" attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}"/>
                                    <div name="delivered_qty" attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}">
                                        <field name="qty_delivered" attrs="{'readonly': [('qty_delivered_method', '!=', 'manual')]}"/>
                                    </div>
                                    <label for="qty_invoiced" string="Invoiced" attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}"/>
                                    <div name="invoiced_qty" attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}">
                                        <field name="qty_invoiced" attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}"/>
                                    </div>
                                    <field name="product_packaging_qty" attrs="{'invisible': ['|', ('product_id', '=', False), ('product_packaging_id', '=', False)]}" groups="product.group_stock_packaging"/>
                                    <field name="product_packaging_id" attrs="{'invisible': [('product_id', '=', False)]}" context="{'default_product_id': product_id, 'tree_view_ref':'product.product_packaging_tree_view', 'form_view_ref':'product.product_packaging_form_view'}" groups="product.group_stock_packaging" />
                                    <field name="price_unit"/>
                                    <field name="tax_id" widget="many2many_tags" options="{'no_create': True}" context="{'search_view_ref': 'account.account_tax_view_search'}" domain="[('type_tax_use','=','sale'), ('company_id','=',parent.company_id), ('country_id', '=', parent.tax_country_id)]"
                                        attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"/>
                                    <label for="discount" groups="product.group_discount_per_so_line"/>
                                    <div name="discount" groups="product.group_discount_per_so_line">
                                        <field name="discount" class="oe_inline"/> %
                                    </div>
                                    <!--
                                        We need the sequence field to be here
                                        because we want to be able to overwrite the default sequence value in the JS
                                        in order for new lines to be added at the correct position.
                                        NOTE: at some point we want to fix this in the framework so that an invisible field is not required.
                                    -->
                                    <field name="sequence" invisible="1"/>
                                </group>
                                <group attrs="{'invisible': [('display_type', '!=', False)]}">
                                    <label for="customer_lead"/>
                                    <div name="lead">
                                        <field name="customer_lead" class="oe_inline"/> days
                                    </div>
                                    <field name="analytic_distribution" widget="analytic_distribution"
                                       groups="analytic.group_analytic_accounting"
                                       options="{'product_field': 'product_id', 'business_domain': 'sale_order'}"/>
                                </group>
                            </group>
                            <label for="name" string="Description" attrs="{'invisible': [('display_type', '!=', False)]}"/>
                            <label for="name" string="Section Name (eg. Products, Services)" attrs="{'invisible': [('display_type', '!=', 'line_section')]}"/>
                            <label for="name" string="Note" attrs="{'invisible': [('display_type', '!=', 'line_note')]}"/>
                            <field name="name"/>
                            <div name="invoice_lines" groups="base.group_no_one" attrs="{'invisible': [('display_type', '!=', False)]}">
                                <label for="invoice_lines"/>
                                <field name="invoice_lines"/>
                            </div>
                            <field name="state" invisible="1"/>
                            <field name="company_id" invisible="1"/>
                        </form>
                        <tree
                            string="Sales Order Lines"
                            editable="bottom"
                        >
                            <control>
                                <create name="add_product_control" string="Add a product"/>
                                <create name="add_section_control" string="Add a section" context="{'default_display_type': 'line_section'}"/>
                                <create name="add_note_control" string="Add a note" context="{'default_display_type': 'line_note'}"/>
                            </control>

                            <field name="sequence" widget="handle" />
                            <!-- We do not display the type because we don't want the user to be bothered with that information if he has no section or note. -->
                            <field name="display_type" invisible="1"/>
                            <field name="product_uom_category_id" invisible="1"/>
                            <field name="product_type" invisible="1"/>
                            <field name="product_updatable" invisible="1"/>
                            <field
                                name="product_id"
                                attrs="{
                                    'readonly': [('product_updatable', '=', False)],
                                    'required': [('display_type', '=', False)],
                                }"
                                force_save="1"
                                context="{
                                    'partner_id': parent.partner_id,
                                    'quantity': product_uom_qty,
                                    'pricelist': parent.pricelist_id,
                                    'uom':product_uom,
                                    'company_id': parent.company_id,
                                    'default_lst_price': price_unit,
                                    'default_description_sale': name
                                }"
                                options="{
                                    'no_open': True,
                                }"
                                domain="[('sale_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                                widget="sol_product_many2one"
                            />
                            <field name="product_template_id"
                                string="Product"
                                invisible="1"
                                attrs="{
                                    'readonly': [('product_updatable', '=', False)],
                                    'required': [('display_type', '=', False)],
                                }"
                                context="{
                                    'partner_id': parent.partner_id,
                                    'quantity': product_uom_qty,
                                    'pricelist': parent.pricelist_id,
                                    'uom':product_uom,
                                    'company_id': parent.company_id,
                                    'default_list_price': price_unit,
                                    'default_description_sale': name
                                }"
                                options="{
                                    'no_open': True,
                                }"
                                domain="[('sale_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                                widget="sol_product_many2one"/>
                            <field name="name" widget="section_and_note_text" optional="show"/>
                            <field name="analytic_distribution" widget="analytic_distribution"
                                       optional="hide"
                                       groups="analytic.group_analytic_accounting"
                                       options="{'product_field': 'product_id', 'business_domain': 'sale_order'}"/>
                            <field
                                name="product_uom_qty"
                                decoration-info="(not display_type and invoice_status == 'to invoice')" decoration-bf="(not display_type and invoice_status == 'to invoice')"
                                context="{
                                    'partner_id': parent.partner_id,
                                    'quantity': product_uom_qty,
                                    'pricelist': parent.pricelist_id,
                                    'uom': product_uom,
                                    'company_id': parent.company_id
                                }"
                            />
                            <field
                                name="qty_delivered"
                                decoration-info="(not display_type and invoice_status == 'to invoice')" decoration-bf="(not display_type and invoice_status == 'to invoice')"
                                string="Delivered"
                                attrs="{
                                    'column_invisible': [('parent.state', 'not in', ['sale', 'done'])],
                                    'readonly': [('qty_delivered_method', '!=', 'manual')]
                                }"
                                optional="show"
                            />
                            <field name="qty_delivered_method" invisible="1"/>
                            <field
                                name="qty_invoiced"
                                decoration-info="(not display_type and invoice_status == 'to invoice')" decoration-bf="(not display_type and invoice_status == 'to invoice')"
                                string="Invoiced"
                                attrs="{'column_invisible': [('parent.state', 'not in', ['sale', 'done'])]}"
                                optional="show"
                            />
                            <field name="qty_to_invoice" invisible="1"/>
                            <field name="product_uom_readonly" invisible="1"/>
                            <field name="product_uom" invisible="1" groups="!uom.group_uom"/>
                            <field
                                name="product_uom"
                                force_save="1"
                                string="UoM"
                                attrs="{
                                    'readonly': [('product_uom_readonly', '=', True)],
                                    'required': [('display_type', '=', False)],
                                }"
                                context="{'company_id': parent.company_id}"
                                groups="uom.group_uom"
                                options='{"no_open": True}'
                                optional="show"
                            />
                            <field
                                name="customer_lead"
                                optional="hide"
                                attrs="{'readonly': [('parent.state', 'not in', ['draft', 'sent', 'sale'])]}"
                            />
                            <field name="product_packaging_qty" attrs="{'invisible': ['|', ('product_id', '=', False), ('product_packaging_id', '=', False)]}" groups="product.group_stock_packaging" optional="show"/>
                            <field name="product_packaging_id" attrs="{'invisible': [('product_id', '=', False)]}" context="{'default_product_id': product_id, 'tree_view_ref':'product.product_packaging_tree_view', 'form_view_ref':'product.product_packaging_form_view'}" groups="product.group_stock_packaging" optional="show"/>
                            <field
                                name="price_unit"
                                attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"
                            />
                            <field
                                name="tax_id"
                                widget="many2many_tags"
                                options="{'no_create': True}"
                                domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id), ('country_id', '=', parent.tax_country_id)]"
                                context="{'active_test': True}"
                                attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"
                                optional="show"
                            />
                            <field name="discount" string="Disc.%" groups="product.group_discount_per_so_line" optional="show" widget="sol_discount"/>
                            <field name="is_downpayment" invisible="1"/>
                            <field name="price_subtotal" widget="monetary" groups="account.group_show_line_subtotals_tax_excluded" attrs="{'invisible': [('is_downpayment', '=', True)]}"/>
                            <field name="price_total" widget="monetary" groups="account.group_show_line_subtotals_tax_included" attrs="{'invisible': [('is_downpayment', '=', True)]}"/>
                            <field name="state" invisible="1"/>
                            <field name="invoice_status" invisible="1"/>
                            <field name="currency_id" invisible="1"/>
                            <field name="price_tax" invisible="1"/>
                            <field name="company_id" invisible="1"/>
                        </tree>
                        <kanban class="o_kanban_mobile">
                            <field name="name"/>
                            <field name="product_id"/>
                            <field name="product_uom_qty"/>
                            <field name="product_uom"/>
                            <field name="price_subtotal"/>
                            <field name="price_total"/>
                            <field name="price_tax" invisible="1"/>
                            <field name="price_total" invisible="1"/>
                            <field name="price_unit"/>
                            <field name="display_type"/>
                            <field name="tax_id" invisible="1"/>
                            <field name="company_id" invisible="1"/>
                            <field name="product_updatable" invisible="1"/>
                            <field name="qty_invoiced" invisible="1"/>
                            <field name="product_uom_readonly" invisible="1"/>
                            <templates>
                                <t t-name="kanban-box">
                                    <div t-attf-class="oe_kanban_card oe_kanban_global_click ps-0 pe-0 {{ record.display_type.raw_value ? 'o_is_' + record.display_type.raw_value : '' }}">
                                        <t t-if="!record.display_type.raw_value">
                                            <div class="row g-0">
                                                <div class="col-2 pe-3">
                                                    <img t-att-src="kanban_image('product.product', 'image_128', record.product_id.raw_value)" t-att-title="record.product_id.value" t-att-alt="record.product_id.value" style="max-width: 100%;"/>
                                                </div>
                                                <div class="col-10">
                                                    <div class="row">
                                                        <div class="col">
                                                            <strong t-out="record.product_id.value" />
                                                        </div>
                                                        <div class="col-auto">
                                                            <t t-set="line_price" t-value="record.price_subtotal.value" groups="account.group_show_line_subtotals_tax_excluded"/>
                                                            <t t-set="line_price" t-value="record.price_total.value" groups="account.group_show_line_subtotals_tax_included"/>
                                                            <strong class="float-end text-end" t-out="line_price" />
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-12 text-muted">
                                                            Quantity:
                                                            <t t-out="record.product_uom_qty.value"/> <t t-out="record.product_uom.value"/>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-12 text-muted">
                                                            Unit Price:
                                                            <t t-out="record.price_unit.value"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                        <t t-if="record.display_type.raw_value === 'line_section' || record.display_type.raw_value === 'line_note'">
                                            <div class="row">
                                                <div class="col-12">
                                                    <t t-out="record.name.value"/>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                </t>
                            </templates>
                        </kanban>
                    </field>
                    <group name="note_group" col="6" class="mt-2 mt-md-0">
                        <group colspan="4">
                            <field  colspan="2" name="note" nolabel="1" placeholder="Terms and conditions..."/>
                        </group>
                        <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_total">
                            <field name="tax_totals" widget="account-tax-totals-field" nolabel="1" colspan="2" readonly="1"/>
                        </group>
                        <div class="clearfix"/>
                    </group>
                </page>
                <page string="Other Info" name="other_information">
                    <group>
                        <group name="sales_person" string="Sales">
                            <field name="user_id" widget="many2one_avatar_user"/>
                            <field name="team_id" kanban_view_ref="%(sales_team.crm_team_view_kanban)s" options="{'no_create': True}"/>
                            <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"/>
                            <label for="require_signature" string="Online confirmation"/>
                            <div>
                                <field name="require_signature" class="oe_inline"/>
                                <span>Signature</span>
                                <field name="require_payment" class="oe_inline ms-3"/>
                                <span>Payment</span>
                            </div>
                            <field name="reference" readonly="1" attrs="{'invisible': [('reference', '=', False)]}"/>
                            <field name="client_order_ref"/>
                            <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color', 'no_create_edit': True}"/>
                        </group>
                        <group name="sale_info" string="Invoicing and Payments">
                            <field name="show_update_fpos" invisible="1"/>
                            <label for="fiscal_position_id"/>
                            <div class="o_row">
                                <field name="fiscal_position_id" options="{'no_create': True}"/>
                                <button name="action_update_taxes" type="object"
                                    string=" Update Taxes"
                                    help="Recompute all taxes based on this fiscal position"
                                    class="btn-link mb-1 px-0" icon="fa-refresh"
                                    confirm="This will update all taxes based on the currently selected fiscal position."
                                    attrs="{'invisible': ['|', ('show_update_fpos', '=', False), ('state', 'in', ['sale', 'done','cancel'])]}"/>
                            </div>
                            <field name="partner_invoice_id" groups="!account.group_delivery_invoice_address" invisible="1"/>
                            <field name="analytic_account_id" context="{'default_partner_id':partner_invoice_id, 'default_name':name}" attrs="{'readonly': [('invoice_count','!=',0),('state','=','sale')]}" groups="analytic.group_analytic_accounting" force_save="1"/>
                            <field name="invoice_status" states="sale,done" groups="base.group_no_one"/>
                            <!-- test_event_configurator -->
                            <field name="invoice_status" invisible="1" groups="!base.group_no_one"/>
                        </group>
                    </group>
                    <group>
                        <group name="sale_shipping">
                            <label for="commitment_date" string="Delivery Date"/>
                            <div name="commitment_date_div" class="o_row">
                                <field name="commitment_date"/>
                                <span name="expected_date_span" class="text-muted">Expected: <field name="expected_date" class="oe_inline" widget="date"/></span>
                            </div>
                        </group>
                        <group string="Tracking" name="sale_reporting">
                            <group name="technical" colspan="2" class="mb-0">
                                <field name="origin"/>
                            </group>
                            <group name="utm_link" colspan="2" class="mt-0">
                                <field name="campaign_id" options="{'create_name_field': 'title', 'always_reload': True}"/>
                                <field name="medium_id"/>
                                <field name="source_id"/>
                            </group>
                        </group>
                    </group>
                </page>
                <page groups="base.group_no_one" string="Customer Signature" name="customer_signature" attrs="{'invisible': [('require_signature', '=', False), ('signed_by', '=', False), ('signature', '=', False), ('signed_on', '=', False)]}">
                    <group>
                        <field name="signed_by"/>
                        <field name="signed_on"/>
                        <field name="signature" widget="image"/>
                    </group>
                </page>
            </notebook>
        </sheet>
        <div class="oe_chatter">
            <field name="message_follower_ids"/>
            <field name="activity_ids"/>
            <field name="message_ids"/>
        </div>
        </form>
    </field>
</record>
```
> 这个例子用的是销售订单的 form 视图, 基本上涵盖了大部分的标签和使用场景

![form-view](/images/odoo/S04/form_view.png)

## Gantt

甘特图是一种比较特殊的图表视图, 一般用作日历安排; 根标签是  `<gantt>`, 接收以下属性:
- `date_start`: 必填参数, 为每一条记录提供事件的开始时间;
- `date_stop`: 必填参数, 为每一条记录提供事件的结束时间;
- `dependency_field`: 关联 many2many 的字段名称; 如果 B 依赖 A, 那么 `dependency_field` 是允许从 B 获取 A 的字段;
- `dependency_inverted_field`: 当设置了 `dependency_field` 的时候这个属性必填; 提供 `dependency_field` 反向关联 many2many 字段的名称; 如果 B 依赖于 A; `dependency_inversed_field` 是允许从 A 获得 B 的字段;
- `color`: 根据字段设置不同的颜色;
- `decoration-{$name}`: 允许根据相应记录的属性更改行文本的样式; 可选: `danger`, `info`, `secondary`, `success`, `warning`;
- `default_group_by`: 任务分组字段;
- `disable_drag_drop`: 禁用甘特图的拖拽功能;
- `consolidation`: 在单元格中显示合并的字段名;
- `consolidation_max`: 以分组字段为依据, 设置合并单元格的最大值; eg: `{"user_id": 100}`;
- `consolidation_exclude`: 从合并任务中排除的字段;
- `create`: 禁用/启用, 添加按钮;
- `cell_create`: 如果启用了 `create`功能, 设置这个属性之后, 将鼠标停留在单元格的时候, 会显示 `+` 按钮, 可以在单元格中创建任务;
- `edit`: 禁用/启用 编辑功能;
- `plan`: 如果启用了 `edit`功能, 单元格会显示一个放大镜按钮, 用于将未分配的记录放到单元格中;
- `offset`: 根据比例添加以今天为单位的周期单位数; eg: `+1` 将打开下周的 gantt 视图,  `-2` 将打开 2 个月之前的 gantt 图;
- `progress`: 事件的完成比例; 0-100 之间;
- `string`: 标题;
- `precision`: json 对象, 指定刻度中的颗粒度; 默认是 `hour`, 可选:
    - 当刻度单位为 `day` 时:
        - `hour`: 记录时间为整小时; eg: `7:12` --> `8:00`;
        - `hour:half`: 记录时间为半小时; eg: `7:12` --> `7:30`;
        - `hour:quarter`: 记录时间为刻度; eg: `7:12` --> `7:15`;
    - 当刻度单位为 `week` 时:
        - `day`: 记录时间为全天; eg: 上午的 `7:28` 变为前一天的晚上 `11:59:59`; 晚上的 `10:32` 变为当天的中午 `12:00`;
        - `day:half`: 记录时间缩短到半天; eh: 上午的 `7:28` 变为下午的 `12:00`;
    - 当时间刻度为 `month` 时:
        - `day`: 记录时间为全天; eg: 上午的 `7:28` 变为前一天的晚上 `11:59:59`; 晚上的 `10:32` 变为当天的中午 `12:00`;
        - `day:half`: 记录时间缩短到半天; eh: 上午的 `7:28` 变为下午的 `12:00`;
    - 当时间刻度为 `year` 时: `{"day": "hour:quarter", "week": "day:half", "month": "day"}`
- `total_row`: 用于控制是否应显示包含记录总数的行;
- `collapse_first_level`: 如果按照字段进行分组时, 用于控制是否可以折叠每一行;
- `display_unavailability`: 将模型的 `gantt_availability` 函数返回的日期标记为在 gantt 视图中可用;
- `default_scale`: 渲染的时候默认的时间刻度缩放比例; 默认值为 `month`; 可选: `day`, `week`, `month`, `year`;
- `scales`: 此视图允许的比例的逗号分隔列表, 默认情况下允许所有的缩放比例;
- `templates`: 允许自定义 `qweb` 模板, 必须至少定义一个根模板 `gantt-popover`; 当用户鼠标悬停在 `gantt` 视图中的一条记录上时候使用该模板; 可以使用的上下文变量有:
    - `widget`: 可以用来获取一些元信息; 转换为颜色整数的 `getColor` 方法也可以直接在模板上下文中使用, 而无需使用小部件;
    - `on_create`: 如果在单击视图上的添加按钮时, 可以指定模型中暴露的方法; 而不是打开常规对话框; eg: `on_create="%(my_module.my_wizard)d"`
- `form_view_id`: 用户打开创建和编辑的时候指定打开的视图的 `xml id`;
- `dynamic_range`: 如果设置为 True, gantt视图将从第一条记录开始, 而不是从 `year/month/day` 开始;
- `pill_label`: 如果设置为 True, 当时间刻度设置为 `week` 或者是 `month` 是, 时间标签会显示在 label 中; eg: `7:00 AM - 11:00 AM (4h) - DST Task 1`;
- `thumbnails`: 如果是关联字段, 可以在组名旁边显示缩略图; eg: `thumbnails="{'user_id': 'image_128'}"`

```xml
<record id="workcenter_line_gantt_production" model="ir.ui.view">
    <field name="name">mrp.production.work.order.gantt.production</field>
    <field name="model">mrp.workorder</field>
    <field name="arch" type="xml">
        <gantt class="o_mrp_workorder_gantt" 
            date_stop="date_planned_finished" 
            date_start="date_planned_start" 
            string="Operations" 
            default_group_by="production_id" 
            create="0" 
            delete="0"
            progress="progress" plan="0"
            decoration-danger="json_popover and 'text-danger' in json_popover"
            decoration-success="state == 'done'"
            decoration-warning="state == 'cancel' or (json_popover and 'text-warning' in json_popover)"
            color="workcenter_id"
            display_unavailability="1"
            sample="1"
            form_view_id="%(mrp_production_workorder_form_view_inherit)d">

            <field name="date_planned_start"/>
            <field name="state"/>
            <field name="workcenter_id"/>
            <field name="json_popover"/>

            <templates>
                <div t-name="gantt-popover" class="container-fluid">
                    <div class="row g-0">
                        <div class="col">
                            <ul class="ps-1 mb-0 list-unstyled">
                                <li><strong>Start Date: </strong> <t t-out="userTimezoneStartDate.format('L LTS')"/></li>
                                <li><strong>Stop Date: </strong> <t t-out="userTimezoneStopDate.format('L LTS')"/></li>
                                <li><strong>Workcenter: </strong> <t t-out="workcenter_id[1]"/></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </templates>
        </gantt>
    </field>
</record>
```

## Graph

`graph` 一般用来展示统计图表, 根组件标签为 `<graph>`, 接收以下参数:
- `type`: 统计图表的类型, 默认为 `bar`, 可选 `pie`, `line`;
- `stacked`: 仅用于条形图, 用于控制图表视图中数据系列的堆叠方式;
- `disable_linking`: 用于控制图表视图中数据点的链接行为; 启用/禁用 数据点的链接, 允许用户点击数据点进行导航到相关记录;
- `order`: 用于指定数据的排序方式, 以控制数据点的显示顺序; 默认情况下 x 轴将根据给定的 `asc`, `desc` 进行排序; 仅用于 `bar` 或 `pie`
- `string`: 标题; 重定向到列表视图时, 面包屑中显示的文本;
- `name`: 要在视图中使用的字段的名称;
- `invisible`: 用于控制图表视图的可见性, 可以选择是否隐藏某个特定的图表视图;
- `interval`: 用于控制图表数据点的时间间隔, 可以应用于时间序列数据的图表视图, 以指定数据点之间的时间间隔; 默认是 `month`, 可选: `day`, `week`, `month`, `quarter`, `year`;

```xml
<record id="crm_lead_view_graph_forecast" model="ir.ui.view">
    <field name="name">crm.lead.view.graph.forecast</field>
    <field name="model">crm.lead</field>
    <field name="priority">32</field>
    <field name="arch" type="xml">
        <graph string="Opportunities Forecast" sample="1" js_class="forecast_graph">
            <field name="date_deadline"/>
            <field name="prorated_revenue" type="measure"/>
            <field name="automated_probability" invisible="1"/>
            <field name="color" invisible="1"/>
            <field name="day_open" invisible="1"/>
            <field name="day_close" invisible="1"/>
            <field name="message_bounce" invisible="1"/>
            <field name="probability" invisible="1"/>
            <field name="recurring_revenue_monthly" groups="crm.group_use_recurring_revenues"/>
            <field name="recurring_revenue_monthly_prorated" groups="crm.group_use_recurring_revenues"/>
            <field name="recurring_revenue" groups="crm.group_use_recurring_revenues"/>
        </graph>
    </field>
</record>
```
![graph-view](/images/odoo/S04/graph_view.png)

## Kanban

看板视图也是一种特殊的列表视图, 将数据以卡片的形式展示; 根元素为 `<kanban>`, 接收以下参数:
- `default_group_by`: 默认展示分组字段的名称;
- `default_order`: 默认排序;
- `class`: html 的 class;
- `examples`: 示例卡片字段, 以便在创建新纪录是显示预填充的示例数据;
- `group_create`: `Add a new column` 按钮是否可见;
- `group_delete`: 用于控制用户是否可以删除整个卡片分组;
- `group_edit`: 用于控制用户是否可以编辑卡片分组;
- `archivable`: 记录是否可以进行 归档/恢复;
- `quick_create`: 是否可以在不切换到表单视图的情况下创建记录;
- `quick_create_view`: 点击快速创建时打开的表单视图的 `xml id`;
- `records_draggable`: 用于控制用户是否可以拖动和重新排序卡片记录;
- `groups_draggable`: 用于控制用户是否可以拖动组和重新排序组;

看板的子元素有:
- `<field>`: 声明要在看板逻辑中使用的字段. 如果该字段只是显示在看板视图中, 则不需要预先声明;
    - `name`: 字段名称
    - `allow_group_range_value`: 用于控制用户是否可以通过拖动更改分组范围的值; 当设置为True时, 用户可以通过拖动卡片条目来更改它们分组的值;
- `<progressbar>`: 声明一个 `progressbar` 元素放在看板列的顶部;
    - `field`: 必填; 字段名称, 用于在进度条中对列的记录进行分组;
    - `colors`: 必填; json, 用于根据值来显示不同的颜色; 可选: `danger`, `warning`, `success`, `muted`;
    - `sum_field`: 列的记录值将被求和并显示在进度条旁边的字段的名称;
- `<templates>`: 自定义的 `qweb` 视图, 必须至少定义一个根模板 `kanban-box`, 接收以下属性:
    - `widget`: 可以用来获取一些当前看板元信息; 这些方法也可以直接在模板上下文中使用, 不需要通过小部件访问;
    - `record`: 将所有请求的字段作为其属性的对象, 每个字段都有两个属性 `value` 和 `raw_value`, 前者根据当前用户参数进行格式化, 后者是 `read()` 中的值;
    - `context`: 当前上下文, 以及在看板视图嵌入 form 视图的情况下的 `One2many` 或者是 `Many2many` 字段;
    - `user_context`: 用户的上下文;
    - `read_only_mode`: 只读状态;
    - `selection_mode`: 在移动环境中单击 `m2o/m2m` 字段打开看板视图;
  
```xml
<record id="crm_case_kanban_view_leads" model="ir.ui.view">
    <field name="name">crm.lead.kanban.lead</field>
    <field name="model">crm.lead</field>
    <field name="priority" eval="1"/>
    <field name="arch" type="xml">
        <kanban default_group_by="stage_id" class="o_kanban_small_column o_opportunity_kanban" on_create="quick_create" quick_create_view="crm.quick_create_opportunity_form"
            archivable="false" sample="1" js_class="crm_kanban">
            <field name="stage_id" options='{"group_by_tooltip": {"requirements": "Description"}}'/>
            <field name="probability"/>
            <field name="color"/>
            <field name="priority"/>
            <field name="expected_revenue"/>
            <field name="kanban_state"/>
            <field name="activity_date_deadline"/>
            <field name="user_id"/>
            <field name="partner_id"/>
            <field name="activity_summary"/>
            <field name="active"/>
            <field name="company_currency"/>
            <field name="activity_state" />
            <field name="activity_ids" />
            <field name="recurring_revenue_monthly"/>
            <progressbar field="activity_state" colors='{"planned": "success", "today": "warning", "overdue": "danger"}'
                sum_field="expected_revenue" recurring_revenue_sum_field="recurring_revenue_monthly"
                help="This bar allows to filter the opportunities based on scheduled activities."/>
            <templates>
                <t t-name="kanban-box">
                    <t t-set="lost_ribbon" t-value="!record.active.raw_value and record.probability and record.probability.raw_value == 0"/>
                    <div t-attf-class="#{!selection_mode ? kanban_color(record.color.raw_value) : ''} #{lost_ribbon ? 'oe_kanban_card_ribbon' : ''} oe_kanban_global_click oe_kanban_card d-flex flex-column">
                        <div class="ribbon ribbon-top-right"
                            attrs="{'invisible': ['|', ('probability', '&gt;', 0), ('active', '=', True)]}">
                            <span class="bg-danger">Lost</span>
                        </div>

                        <div class="o_dropdown_kanban dropdown">
                            <a class="dropdown-toggle o-no-caret btn" role="button" data-bs-toggle="dropdown" data-bs-display="static" href="#" aria-label="Dropdown menu" title="Dropdown menu">
                                <span class="fa fa-ellipsis-v"/>
                            </a>
                            <div class="dropdown-menu" role="menu">
                                <t t-if="widget.editable"><a role="menuitem" type="edit" class="dropdown-item">Edit</a></t>
                                <t t-if="widget.deletable"><a role="menuitem" type="delete" class="dropdown-item">Delete</a></t>
                                <ul class="oe_kanban_colorpicker" data-field="color"/>
                            </div>
                        </div>
                        <div class="oe_kanban_content flex-grow-1">
                            <div class="o_kanban_record_title oe_kanban_details">
                                <strong><field name="name"/></strong>
                            </div>
                            <div class="o_kanban_record_subtitle">
                                <t t-if="record.expected_revenue.raw_value">
                                    <field name="expected_revenue" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                                    <span t-if="record.recurring_revenue and record.recurring_revenue.raw_value" groups="crm.group_use_recurring_revenues"> + </span>
                                </t>
                                <t t-if="record.recurring_revenue and record.recurring_revenue.raw_value">
                                    <field name="recurring_revenue" widget="monetary" options="{'currency_field': 'company_currency'}" groups="crm.group_use_recurring_revenues"/>
                                    <field name="recurring_plan" groups="crm.group_use_recurring_revenues"/>
                                </t>
                            </div>
                            <div>
                                <span class="o_text_overflow" t-if="record.partner_id.value" t-esc="record.partner_id.value"></span>
                            </div>
                            <div>
                                <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                            </div>
                        </div>
                        <div class="oe_kanban_footer">
                            <div class="o_kanban_record_bottom">
                                <div class="oe_kanban_bottom_left">
                                    <field name="priority" widget="priority" groups="base.group_user"/>
                                    <field name="activity_ids" widget="kanban_activity"/>
                                </div>
                                <div class="oe_kanban_bottom_right">
                                    <field name="user_id" widget="many2one_avatar_user"/>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"/>
                    </div>
                </t>
            </templates>
        </kanban>
    </field>
</record>
```
![kanban-view](/images/odoo/S04/kanban_view.png)

## List(Tree)

用于展示数据列表, 根元素为 `<tree>`, 接收以下参数:
- `editable`: 默认情况下是打开 form 视图, 设置之后可以使列表行可编辑; 有效值为 `top`, `bottom`; 用于在列表顶部编辑还是底部编辑;
- `multi_edit`: 可编辑或不可编辑列表可以通过定义 `multi_edit=1` 来激活多重编辑功能;
- `default_order`: 默认排序规则; 该值是一个逗号分隔的字段列表, 由 `desc` 后缀以按相反顺序排序: `<tree default_order="sequence,name desc">`;
- `decoration-{$name}`: 允许根据相应记录的属性更改行的样式; 可选: `bf`(font-weight: bold), `it`(font-style: italic), 或者是 bootstrap 的颜色类; `danger`, `info`, `muted`, `primary`, `success`, `warning`;
- `create, edit, delete, import, export_xlsx`: 禁用/启用列表的 创建, 编辑, 删除, 导入, 导出功能;
- `limit`: 列表展示的数据的 `limit`;
- `groups_limit`: 列表分组展示时候的 `limit`;
- `expand`: 对列表进行分组的时候, 是否默认展开;

列表视图的子元素:
- `<button>`: 在单元格中显示按钮, 接收以下属性:
    - `icon`: 按钮展示的 icon;
    - `string`: 如果没有设置 icon, 那么 string 为按钮的文字, 如果设置了 icon, string 为按钮的 alt 属性;
    - `type`: 按钮的类型:
        - `object`: 调用模型里面的一个方法, `name` 为方法名; 该方法会传入前行的 id 和当前行的上下文;
        - `action`: 加载一个 `ir.actions`, 按钮的 `name` 为 action id; context 会带入当前的模型名称, 当前行的 active_id 和列表中加载的所有记录的 ids;
    - `args`: 根据 type 类型传入不同的参数;
    - `attrs`: 动态设置属性;
    - `states`: `invisible` 属性的简写; 如果记录不处于列出的状态之一, 则使按钮不可见;
    - `context`: 在点击按钮的时候, 将 context 合并到 odoo 的上下文中;
- `<field>`: 定义列显示的字段, 可以使用以下属性:
    - `name`: 显示字段的名称;
    - `string`: 表格的头部显示的列名;
    - `invisible`: 设置字段的可见性;
    - `groups`: 哪些用户组可见;
    - `widget`: 显示字段的小部件定义;
        - `progressbar`: float 字段显示为进度条;
        - `handle`: 对于记录的排序的序列 integer 字段不显示字段的值, 只显示一个拖放图标来重新排序记录;
    - `sum, avg`: 对字段进行汇总和平均值计算, 方便用户在 `tree` 视图中快速了解字段的汇总统计信息;
    - `attrs`: 动态设置字段属性;
    - `width`: 当列表中没有数据时, 可以通过设置此属性来强制设置列的宽度;
    - `decoration-{$name}`: 允许根据相应记录的属性更改单元格文本的样式; 可选: `bf`(font-weight: bold), `it`(font-style: italic), 或者是 bootstrap 的颜色类; `danger`, `info`, `muted`, `primary`, `success`, `warning`;
    - `nolabel`: 如果设置为 `1`, 列表的标题显示为空, 并且该列不可以排序;
    - `optional`: 使列称为可选列, 如果设置为 `hide` 则默认隐藏列; 可以通过列表右侧的展开功能设置显示/隐藏;
    - `column_invisible`: 如果列表是以 `One2many/Many2many` 展示为子表的时候, 可以通过此属性设置列的 显示/隐藏; `<field name="product_is_late" attrs="{'column_invisible': [('parent.has_late_products', '=', False)]}"/>`
- `<groupby>`: 在对多个 `many2one` 的字段进行分组时, 可以在 `groupby` 内部添加字段:
```xml
<groupby name="partner_id">
    <field name="name"/> <!-- name of partner_id -->
    <button type="edit" name="edit" string="Edit"/>
    <button type="object" name="my_method" string="Button1"
          attrs="{'invisible': [('name', '=', 'Georges')]}"/>
</groupby>
```
- `<control>`: 定制当前视图的控制器组件; 如果 `<tree>` 作为一个 `One2many` 的子视图的时候这个是非常的有用的; 
```xml
<control>
    <create
        string="Add a product"
    />
    <create
        string="Add a section"
        context="{'default_display_type': 'line_section'}"
    />
    <create
        string="Add a note"
        context="{'default_display_type': 'line_note'}"
    />
</control> 
```

```xml
<record id="crm_case_tree_view_oppor" model="ir.ui.view">
    <field name="name">crm.lead.tree.opportunity</field>
    <field name="model">crm.lead</field>
    <field name="priority">1</field>
    <field name="arch" type="xml">
        <tree string="Opportunities" sample="1" multi_edit="1">
            <header>
                <button name="%(crm.action_lead_mass_mail)d" type="action" string="Email" />
            </header>
            <field name="company_id" invisible="1"/>
            <field name="user_company_ids" invisible="1"/>
            <field name="date_deadline" invisible="1"/>
            <field name="create_date" optional="hide"/>
            <field name="name" string="Opportunity" readonly="1"/>
            <field name="partner_id" optional="hide"/>
            <field name="contact_name" optional="show"/>
            <field name="email_from"/>
            <field name="phone" class="o_force_ltr"/>
            <field name="company_id" groups="base.group_multi_company" optional="show"/>
            <field name="city" optional="hide"/>
            <field name="state_id" optional="hide"/>
            <field name="country_id" optional="hide" options="{'no_open': True, 'no_create': True}"/>
            <!-- Explicit domain due to multi edit -> real company domain would be complicated -->
            <field name="user_id" widget="many2one_avatar_user" optional="show"
                   domain="[('share', '=', False)]"/>
            <field name="team_id" optional="hide"/>
            <field name="priority" optional="hide" widget="priority"/>
            <field name="activity_ids" widget="list_activity"/>
            <field name="activity_user_id" optional="hide" string="Activity by" widget="many2one_avatar_user"/>
            <field name="my_activity_date_deadline" string="My Deadline" widget="remaining_days" options="{'allow_order': '1'}"/>
            <field name="activity_calendar_event_id" invisible="1"/>
            <field name="campaign_id" optional="hide"/>
            <field name="medium_id" optional="hide"/>
            <field name="source_id" optional="hide"/>
            <field name="company_currency" invisible="1"/>
            <field name="expected_revenue" sum="Expected Revenues" optional="show" widget="monetary" options="{'currency_field': 'company_currency'}"/>
            <field name="date_deadline" optional="hide"/>
            <field name="recurring_revenue_monthly" sum="Expected MRR" optional="show" widget="monetary"
                   options="{'currency_field': 'company_currency'}" groups="crm.group_use_recurring_revenues"/>
            <field name="recurring_revenue" sum="Recurring Revenue" optional="hide" widget="monetary"
                   options="{'currency_field': 'company_currency'}" groups="crm.group_use_recurring_revenues"/>
            <field name="recurring_plan" optional="hide" groups="crm.group_use_recurring_revenues"/>
            <field name="stage_id" optional="show" decoration-bf="1"/>
            <field name="active" invisible="1"/>
            <field name="probability" string="Probability (%)" optional="hide"/>
            <field name="tag_ids" optional="hide" widget="many2many_tags" options="{'color_field': 'color'}"/>
            <field name="referred" invisible="1"/>
            <field name="message_needaction" invisible="1"/>
            <button name="%(crm.action_lead_mail_compose)d" type="action" string="Email" icon="fa-envelope"/>
            <button name="action_reschedule_meeting" class="text-warning" type="object" string="Reschedule"
                    icon="fa-calendar" attrs="{'invisible': ['|', ('my_activity_date_deadline', '=', False),
                              ('activity_calendar_event_id', '=', False)]}"/>
            <button name="action_snooze" class="text-warning" type="object" string="Snooze 7d"
                    icon="fa-bell-slash" attrs="{'invisible': ['|', ('my_activity_date_deadline', '=', False),
                              ('activity_calendar_event_id', '!=', False)]}"/>
        </tree>
    </field>
</record>
```
![tree-view](/images/odoo/S04/tree_view.png)

## Pivot

透视表, 可以快速查看和分析大量的数据, 用户可以根据自己的需求对数据进行灵活的汇总, 筛选, 排序和展示; 透视表的根节点 `<pivot>`, 接收下面的参数:
- `disable_linking`: 设置为 `1` 时可删除单元格到列表视图的连接;
- `display_quantity`: 设置为 `1` 时可展示数量列;
- `default_order`: 设置默认的排序字段; 可选 `asc`, `desc`; eg: `<pivot default_order="foo asc">`;

透视表中, 唯一允许的子元素只有 `field`, 接收以下属性:
- `name`: 字段名称;
- `string`: 用于在透视表中展示的名称;
- `type`: 字段在透视表中的作用和行为, 这些属性可以控制字段的聚合方式, 显示格式和计算规则, 从而影响透视表中数据的呈现和分析; 可以为以下值:
    - `row`: 按照指定字段分组, 每个组都有自己的行;
    - `col`: 按照列分组;
    - `measure`: 要在组中聚合的字段;
    - `interval`: 在日期字段中, 指定字段的分组间隔(`day`, `week`, `month`, `quarter`, `year`); 
- `invisible`: 设置字段的显示隐藏;

> 与 `graph` 视图一样, `pivot` 视图聚合的是数据库的数据, 这意味着未在数据库中存储的字段不能在 `pivot` 视图中使用;

```xml
<record id="crm_lead_view_pivot" model="ir.ui.view">
    <field name="name">crm.lead.view.pivot</field>
    <field name="model">crm.lead</field>
    <field name="arch" type="xml">
        <pivot string="Pipeline Analysis" sample="1">
            <field name="create_date" interval="month" type="row"/>
            <field name="stage_id" type="col"/>
            <field name="expected_revenue" type="measure"/>
            <field name="color" invisible="1"/>
            <field name="automated_probability" invisible="1"/>
            <field name="message_bounce" invisible="1"/>
            <field name="probability" invisible="1"/>
            <field name="recurring_revenue_monthly" type="measure" groups="crm.group_use_recurring_revenues"/>
            <field name="recurring_revenue_monthly_prorated" groups="crm.group_use_recurring_revenues"/>
            <field name="recurring_revenue" groups="crm.group_use_recurring_revenues"/>
        </pivot>
    </field>
</record>
```
![pivot-view](/images/odoo/S04/pivot_view.png)

## QWeb

`QWeb` 构建网页界面的模块化模板, 没有特定的根元素, 允许开发人员自定义网页视图的结构外观;

将 `qweb` 添加到模板的主要内容有:
- `<nav>`: 对于 `<nav>` 元素有 `class="o_qweb_cp_buttons"` 这个类名的: 它的内容应该是 `buttons`, 并且将被提取并移动到控制面板的按钮区域, `<nav>` 元素将被删除, 这是一个解决没有控制面板视图的办法;
- `qweb` 视图将下面几个上下文添加到 `qweb` 渲染上下文上:
    - `model`: `qweb` 视图绑定的模型;
    - `domain`: 记录集的 domain;
    - `context`: 上下文;
    - `records`: `model.search()` 方法调用后的结果;
    - `qweb` 还提供了一些渲染时候的钩子函数:
        - `_qweb_prepare_context(view_id, domain)`: `qweb 渲染之前的预处理函数`;
        - `qweb_render_view(view_id, domain)`: 客户端调用 `env['ir.qweb'].render()` 方法之前的调用方法;


```xml
<record id="view_view_qweb" model="ir.ui.view">
    <field name="name">View Hierarchy</field>
    <field name="type">qweb</field>
    <field name="model">ir.ui.view</field>
    <field name="arch" type="xml">
        <qweb js_class="view_hierarchy">
            <nav class="o_tree_nav navbar justify-content-start w-100 fixed-top bg-white shadow">
                <div class="dropdown ms-2 border border-info rounded">
                    <a href="#" role="button" class="btn dropdown-toggle text-info" data-bs-toggle="dropdown">
                        All Websites
                    </a>
                    <div class="dropdown-menu o_website_filter">
                        <a href="#" class="dropdown-item active" data-website_name="*">All Websites</a>
                    </div>
                </div>
                <div class="ms-2 form-check form-switch">
                    <input id="o_show_inactive" class="form-check-input" type="checkbox"/>
                    <label class="form-check-label" for="o_show_inactive">Show inactive views</label>
                </div>
                <div class="o_search input-group ms-auto col-8 col-sm-6 col-md-4 col-xl-3" role="search">
                    <input type="search" name="search" class="form-control border-info" placeholder="Name, id or key"/>
                    <button type="submit" class="btn btn-info" aria-label="Search" title="Search">
                        <i class="fa fa-search"/>
                    </button>
                </div>
            </nav>

            <t t-set="view" t-value="env['ir.ui.view'].browse(context['active_id']).with_context(active_test=False)"/>
            <t t-set="requested_view" t-value="view"/>
            <t t-set="view" t-value="view._get_top_level_view()"/>
            <div class="o_tree_container ms-2" t-att-data-requested-view-id="requested_view.id">
                <t t-set="sibling_views" t-value="view.search([('key', '=', view.key)]) - view"/>
                <div t-if="sibling_views" class="alert alert-info m-1 p-1">
                    Multiple tree exists for this view
                    <a t-foreach="sibling_views" t-as="sibling_view" href="#" class="o_load_hierarchy" t-att-data-view_id="sibling_view.id">
                        <i class="fa fa-arrow-right me-1"/>
                        <t t-esc="sibling_view.with_context(display_website=True, display_key=True).display_name"/>
                    </a>
                </div>
                <t t-call="website.report_viewhierarchy_children"/>
            </div>
        </qweb>
    </field>
</record>
```

## Search

`search` 视图与前面的一些视图类型不同, 因为它们不显示内容; 它们适用于特定的模型(`tree`, `graph`); `search` 视图的根节点 `<search>`; 子节点有:
- `<field>`: 需要在数据视图中搜索的字段; 当有多个搜索字段的时候, 将使用 `and` 操作符对数据进行查询; 其中有如下属性:
    - `name`: 字段的名称;
    - `string`: 搜索的时候显示的名称;
    - `operator`: 默认情况下, 字段生成的形式为 `[(name, operator, value)]`, 其中 `name` 是字段的名称, `value` 是用户输入的值; `operator` 属性允许覆盖默认的运算符; 例如: 搜索浮点数时 `operator` 默认是 `=`, 搜索 `char` 类型的字段时, `operator` 默认是 `ilike`;
    - `filter_domain`: 完整的域用于搜索, 可以使用变量提供的值注入自定义域; 可以更灵活的定制搜索; 例如: 一次搜索多个字段; 或者是在主表里面对下面的子表的字段进行查询; 如果同时设置了 `operator` 和 `filter_domain`; 则 `filter_domain` 优先;
    - `context`: 允许添加上下文关键字; 包括用户提供的值; 
    - `groups`: 仅对指定的用户组可见;
    - `domain`: 定义搜索字段的筛选条件, 当用户在搜索框中输入搜索条件时, 系统将根据该条件在相应的字段上应用定义的 domain 过滤;
- `<filter>`: 自定义快捷筛选字段; `filter` 定义的内容将会出现在 `filter` 下拉列表中; 接收以下属性:
    - `string`: 显示的快捷筛选字段的名称;
    - `domain`: 搜索时候的过滤条件;
    - `date`: 时间类型的字段名称, 使用此属性可以创建过滤器菜单的子菜单中可用的过滤器集;
    ```xml
    <!-- 将展示为快捷时间选项; `Q4, Q3, Q2, Q1... -->
    <filter name="filter_create_date" date="create_date" string="Creation Date"/>
    ```
    - `default_period`: `date`属性不为空时生效; 在进行日期字段筛选时, 哪些时间段被激活; 默认为 `this_month`; 可选: `today`, `this_week`, `this_month`, `last_month`, `antepenultimate_month`, `fourth_quarter`, `third_quarter`, `second_quarter`, `first_quarter`, `this_year`, `last_year`, `antepenultimate_year`;
    ```xml
    <filter name="filter_create_date" date="create_date" string="Creation Date" default_period="this_year,last_year"/>
    ```
    - `context`: 定义 `context` 合并到 python 上下问中; `group_by` 可用于分组; eg: `<filter name="groupby_category" string="Category" context="{'group_by': 'category_id'}"/>`
    ```xml
    <!-- 
        上面定义的 `group_by` 用于对数据进行分组, 当字段类型为 `date` 的时候, 可以提供时间间隔进行分组; 可选: `day`, `week`, `month`, `quarter`, `year`.
     -->
    <filter name="groupby_create_date" string="Creation Date" context="{'group_by': 'create_date:week'}"/>
    ```
    - `name`: 过滤器的逻辑名称;
    - `help`: 较长解释性文本可以显示为 `tooltip` 提示;
    - `groups`: 仅对指定的用户组可见;
- `<separator>`: 用于在简单的搜索视图中分离过滤器组; 
    ```xml
    <!--  不使用 separator 下面的 搜索为  state == 'draft' or `done`  -->  
    <filter domain="[('state', '=', 'draft')]"/>
    <filter domain="[('state', '=', 'done')]"/>
  
    <!--  使用 separator 下面的 搜索为  state == 'draft' and `delay &lt 15`  -->  
    <filter domain="[('state', '=', 'draft')]"/>
    <separator/>
    <filter domain="[('delay', '&lt;', 15)]"/>
    ```
- `<group>`: 用于分隔 `filter`, 在复杂的搜索视图中, 可读性更高;
- `<searchpanel>`: 允许在任何多记录视图的左侧显示搜索面板; 默认情况下, 列表和看板视图启用了搜索面板; 搜索面板可以在具有以下属性的其他视图上激活:
    - `view_types`: 要启用搜索面板默认值的视图类型的逗号分隔; eg: `kanban`, `tree`;
    - `name`: 搜索字段的名称;
    - `select`: 定义行为和显示, 可选:
        - `one`: 最多可以选择一个值, 支持的字段类型有 `many2one` 和 `selection`;
        - `multi`: 可以选择多个值, 支持的字段类型有 `many2one`, `many2many` 和 `selection`;
    - `groups`: 仅对指定的用户组可见;
    - `string`: `lable` 标签展示的字符;
    - `icon`: 定义显示的 icon 路径;
    - `color`: 定义显示图标的颜色;
    - `enable_counters`: 启用计数器;
    - `expand`: 如果设置为 `false`, 则包含 0 条记录的类别或筛选器将被隐藏;
    - `limit`: 默认 200, 字段获取值的最大数的整数; 如果达到限制, 搜索面板中将不会显示任何值, 而显示一条错误信息;

```xml
<record id="view_crm_case_opportunities_filter" model="ir.ui.view">
    <field name="name">crm.lead.search.opportunity</field>
    <field name="model">crm.lead</field>
    <field name="priority">15</field>
    <field name="arch" type="xml">
        <search string="Search Opportunities">
            <field name="name" string="Opportunity" filter_domain="[
                              '|', '|', '|', '|',
                              ('partner_id', 'ilike', self),
                              ('partner_name', 'ilike', self),
                              ('email_from', 'ilike', self),
                              ('name', 'ilike', self),
                              ('contact_name', 'ilike', self)]"/>
            <field name="partner_id" operator="child_of" string="Customer" filter_domain="[
                              '|', '|', '|',
                              ('partner_id', 'ilike', self),
                              ('partner_name', 'ilike', self),
                              ('email_from', 'ilike', self),
                              ('contact_name', 'ilike', self)]"/>
            <field name="tag_ids" string="Tag" filter_domain="[('tag_ids', 'ilike', self)]"/>
            <field name="user_id"/>
            <field name="team_id"/>
            <field name="stage_id" domain="[]"/>
            <field name="country_id"/>
            <field name="city"/>
            <field name="phone_mobile_search"/>
            <field name="activity_state"/>
            <separator/>
            <filter string="My Pipeline" name="assigned_to_me"
                    domain="[('user_id', '=', uid)]"
                    help="Opportunities that are assigned to me"/>
            <filter string="Unassigned" name="unassigned"
                    domain="[('user_id', '=', False)]" help="No salesperson"/>
            <filter string="Open Opportunities" name="open_opportunities"
                    domain="[('probability', '&lt;', 100), ('type', '=', 'opportunity')]"
                    help="Open Opportunities"/>
            <separator/>
            <filter string="Unread Messages" name="message_needaction" domain="[('message_needaction', '=', True)]"/>
            <separator/>
            <filter string="Creation Date" name="creation_date" date="create_date"/>
            <filter string="Closed Date" name="close_date" date="date_closed"/>
            <separator/>
            <filter string="Won" name="won" domain="['&amp;', ('active', '=', True), ('stage_id.is_won', '=', True)]"/>
            <filter string="Lost" name="lost" domain="['&amp;', ('active', '=', False), ('probability', '=', 0)]"/>
            <separator/>
            <filter invisible="1" string="Overdue Opportunities" name="overdue_opp" domain="['&amp;', ('date_closed', '=', False), ('date_deadline', '&lt;', context_today().strftime('%Y-%m-%d'))]"/>
            <filter invisible="1" string="Late Activities" name="activities_overdue"
                    domain="[('my_activity_date_deadline', '&lt;', context_today().strftime('%Y-%m-%d'))]"
                    help="Show all opportunities for which the next action date is before today"/>
            <filter invisible="1" string="Today Activities" name="activities_today"
                    domain="[('my_activity_date_deadline', '=', context_today().strftime('%Y-%m-%d'))]"/>
            <filter invisible="1" string="Future Activities" name="activities_upcoming_all"
                    domain="[('my_activity_date_deadline', '&gt;', context_today().strftime('%Y-%m-%d'))]"/>
            <separator/>
            <filter string="Archived" name="inactive" domain="[('active', '=', False)]"/>
            <group expand="0" string="Group By" colspan="16">
                <filter string="Salesperson" name="salesperson" context="{'group_by':'user_id'}"/>
                <filter string="Sales Team" name="saleschannel" context="{'group_by':'team_id'}"/>
                <filter name="stage" string="Stage" context="{'group_by':'stage_id'}"/>
                <filter name="city" string="City" context="{'group_by': 'city'}"/>
                <filter string="Country" name="country" context="{'group_by':'country_id'}" />
                <filter string="Lost Reason" name="lostreason" context="{'group_by':'lost_reason_id'}"/>
                <filter string="Company" name="company" context="{'group_by':'company_id'}" groups="base.group_multi_company"/>
                <filter string="Campaign" name="compaign" domain="[]" context="{'group_by':'campaign_id'}"/>
                <filter string="Medium" name="medium" domain="[]" context="{'group_by':'medium_id'}"/>
                <filter string="Source" name="source" domain="[]" context="{'group_by':'source_id'}"/>
                <separator orientation="vertical" />
                <filter string="Creation Date" name="month" context="{'group_by':'create_date:month'}"
                        invisible="context.get('crm_lead_view_hide_month')"/>
                <filter string="Creation Date" name="group_by_create_date_day" context="{'group_by':'create_date:day'}"
                        invisible="not context.get('crm_lead_view_hide_month')"/>
                <filter string="Conversion Date" name="date_conversion" context="{'group_by': 'date_conversion'}" groups="crm.group_use_lead"/>
                <filter string="Expected Closing" name="date_deadline" context="{'group_by':'date_deadline'}"/>
                <filter string="Closed Date" name="date_closed" context="{'group_by':'date_closed'}"/>
            </group>
        </search>
    </field>
</record>
```
![search-view](/images/odoo/S04/search_view.png)

### Search defaults

`search` 视图可以使用 `search_default_` 键为上下文配置默认的搜索字段和筛选器; 对于字段, 该值应该是要在字段中设置的值; 对于 `filter` 过滤器, 它应该是一个布尔值或者是数字;

```xml
<record model="ir.actions.act_window" id="crm_lead_all_leads">
    <field name="name">Leads</field>
    <field name="res_model">crm.lead</field>
    <field name="view_mode">tree,kanban,graph,pivot,calendar,form,activity</field>
    <field name="domain">['|', ('type','=','lead'), ('type','=',False)]</field>
    <field name="search_view_id" ref="crm.view_crm_case_leads_filter"/>
    <field name="context">{
            'default_type':'lead',
            'search_default_type': 'lead',
            'search_default_to_process':1,
        }
    </field>
    <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
            Create a Lead
        </p><p>
            Leads are the qualification step before the creation of an opportunity.
        </p>
    </field>
</record>
```
`search_default_` 一般是用于菜单上面, 点击菜单打开视图的时候默认搜索条件;


