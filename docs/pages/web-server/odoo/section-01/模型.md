---
headerDepth: 3
prev:
  link: /pages/web-server/odoo/section-01/API.md
next:
  link: /pages/web-server/odoo/section-01/模型.md
---

## 模型

与 python 的其他主流框架类似, odoo 的模型也是数据持久化的主要对象, 它是将数据库字段映射成 python 对象, 方便我们对数据进行处理;

odoo 的模型有下面这些特点:
- 支持对层级结构的数据处理;
- 确保约束一执行和验证数据有效性;
- 对象的元数据根据其状态动态变化;
- 通过复杂查询实现优化的数据处理 (可以同时执行多个操作);
- 支持默认字段数值;
- 优化权限管理;
- 支持与持久化数据库 `PostgreSQL` 的数据交互;
- 数据转换功能;
- 多层级缓存系统;
- 支持多种不同的继承机制;
- 丰富的字段类型: 基础字段( varchar, integer, boolean... ), 关系型字段 (one2many, many2one, many2many);

## 模型的种类

odoo 的模型可以分为一下四种类型:
- **`BaseModel`**: odoo 模型的基类, 所有的模型都是继承自这个类别;
- **`AbstractModel`**: 抽象模型, 用于要由多个继承模型共享的抽象超类;
- **`Model`**: 数据模型, 常规数据库持久化模型;
- **`TransientModel`**: 瞬态模型, 用于临时数据, 存储在数据库中, 但每隔一段时间就会自动清空;

## 基础属性

基础模型包含了一些技术性的参数:
- **`_register`**: 是否注册, 不注册将在 ORM 中不可用; eg: `_register = False`;
- **`_auto`**: 是否应该创建数据表, 如果设置为 False, 需要重新 `init()` 函数来创建数据表; 对于 `Model` 和 `TransientModel`, 自动默认为 `True`, 对于 `AbstractModel`, 默认为 `False`;
- **`_log_access`**: ORM 是否应自动生成和更新访问日志字段; 
- **`_table`**: 指定数据库中的表名;
- **`_sql_constraints`**: sql 的约束, 元组 `list`; eg: `[(name, sql_def, message)]`
- **`_abstract`**: 是否是抽象模型; 
- **`_transient`**: 是否是瞬态模型;
- **`_name`**: 模型的名称, 用 `.` 表示; eg: `library.book`;
- **`_description`**: 模型的描述信息;
- **`_inherit`**: 模型的继承; 如果设置了 `_name`, 则为要继承的父模型的名称; 如果未设置 `_name`, 则为扩展 `inherit` 说标识的模型; (这个比较复杂, 后面会独立展开讨论)
- **`_inherits`**: 将父业务对象的名称映射到要使用的相应外键字段的名称;
```python
class BaseModel(models.Model):
    _name = 'base.model'
    name = fields.Char(string="Name")

class CustomModel(models.Model):
    _name = 'custom.model'
    _inherits = {'base.model': 'base_model_id'}

    base_model_id = fields.Many2one('base.model', string='Base Model', required=True, ondelete='cascade')
    custom_field = fields.Char(string="Custom Field")
```
- **`_rec_name`**: 用于指定显示在 `Many2one` 类型的搜索中的显示字段, 可以简单的理解为该模型的记录集的名称; 默认情况下, `_rec_name` 的取值为 `name` 字段;
- **`_order`**: 排序字段, 默认为 `id`;
- **`_check_company_auto`**: 如果设置为 True, 在 `write`/`create` 记录的时候, 会调用 `_check_company` 方法来校验数据的一致性(多公司下非常有用);
- **`_parent_name`**: 用于存储树形数据时候的关联字段; 默认为 `parent_id`;
- **`_parent_store`**: 默认是 False, 设置为 True 的时候会计算 `parent_path`; 除了 `parent_path` 字段外, 还设置了记录树结构的索引存储; 以便使用运算符 `child_of` 和 `parent_of` 对当前模型的记录进行更快的分层查询;
- **`_fold_name`**: 用于确定看板视图中折叠组的字段; 默认为 `fold`;
- **`_date_name`**: 用于确定在日历视图中使用的字段; 默认为 `date`;
- **`_rec_names_search`**: 在 `name_search` 方法中可以搜索的字段列表;












