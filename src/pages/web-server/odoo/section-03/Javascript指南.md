---
headerDepth: 4
prev:
  link: /pages/web-server/odoo/section-03/Patch.md
next:
  link: /pages/web-server/odoo/section-03/Patch.md
---

## Javascript 指南

这一篇文档主要介绍 odoo 的 Javascript 框架, 它在代码行数上, 绝对算不上是一个大型的框架, 但是它非常的通用, 下面我们就来介绍一下框架的一些能力;


## Web 客户端

这是一个单页面应用, 它不是在每次用户执行动作的时候请求整个页面, 而是只加载更新用户界面所需的内容; 在执行这个动作的时候, 它还负责更新 URL 中的信息, 因此, 在大多数情况下, 刷新页面或者是关闭浏览器, 再次打开的时候它还是会显示相同的内容;

下面的这些目录是 odoo web 框架的核心内容, 它们被放置在 `web/static/src` 目录下:

- **module_loader.js**: 这个是 odoo 模块系统的定义, 它需要在任何其他 js 模块之前加载;
- **core/**: 此目录包含了构成 javascript 框架的最基础的代码, 可用于 web 客户端以及网站, 门户等应用程序;
- **weblient/**: 此目录包含了特定的 web client 的文件, 不能在网站或销售点中使用;
- **webclient/webclient.js**: 这个是 web 客户端组件, 它主要的作用是 container 和 navbar 的容器, 在启动的应用程序时候所需的一些动作;
- **webclient/actions/**: 此目录包含负责控制显示和隐藏的动作代码;
- **views/**: 此目录包含视图基础结构的代码, 以及大多数视图的定义;
- **views/fields/**: 此目录主要是各种字段组件的定义, 以及一些字段使用的 widget 组件;
- **search/**: search 视图的定义文件;
 
## Javascript 模块

大型的应用, 一般都需要拆分多个文件, 文件之间需要共享代码, 传统的方式是通过全局作用域(window对象) 共享, 但是会存在一些问题:
- 难以隐藏实现细节(所有的函数都是全局可见的);
- 单一命名空间容易导致命名冲突;
- 依赖关系不明确, 加载顺序难以保证;

解决方案:
- 模块系统, 让每个模块都可以明确导入/导出值;
- 自动处理依赖之间的关系和加载顺序;
- 提供独立的命名空间, 避免暴露实现细节和命名冲突;

odoo 框架的特殊考虑: 虽然 ES 模块是标准的方案, 但是直接使用会有一些问题:
- 每个模块都需要网络请求, 这个在文件多的时候会比较慢;
- 很多文件即使在不被直接导入的时候, 也需要存在(为框架提供一些基础能力)

因此, odoo 采用了资产包(assets bundles)系统:
- 文件仍是 ES 模块, 但有特殊注解;
- 这些模块会被打包并转义, 供 odoo 的模块加载器使用;
- 推荐使用这种官方的方式而非直接写普通的 js 代码;

简单来说, 就是解释了为什么大型应用需要模块化系统, 以及 odoo 框架如何通过自己的模块打包系统来优化标准的 ES 模块方案;














